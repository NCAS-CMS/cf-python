
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "recipes/plot_22_recipe.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_recipes_plot_22_recipe.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_recipes_plot_22_recipe.py:


Plotting a wind rose as a scatter plot
======================================

Given a file containing northerly and easterly wind components, we can
calculate the magnitude and bearing of the resultant wind at each point
in the region and plot them using a scatter plot on a polar grid to
create a wind rose representing wind vectors in the given area.

.. GENERATED FROM PYTHON SOURCE LINES 12-13

1. Import cf-python, along with Dask.array, NumPy, and Matplotlib:

.. GENERATED FROM PYTHON SOURCE LINES 13-21

.. code-block:: Python


    import matplotlib.pyplot as plt
    import dask.array as da
    import numpy as np

    import cf









.. GENERATED FROM PYTHON SOURCE LINES 22-23

2. Read the field constructs and load the wind speed component fields:

.. GENERATED FROM PYTHON SOURCE LINES 23-31

.. code-block:: Python


    f = cf.read("~/recipes/data1.nc")
    print(f)

    U = f[2].squeeze()  # Easterly wind speed component
    V = f[3].squeeze()  # Northerly wind speed component






.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    [<CF Field: divergence_of_wind(time(1), pressure(23), latitude(160), longitude(320)) s**-1>,
     <CF Field: long_name=Ozone mass mixing ratio(time(1), pressure(23), latitude(160), longitude(320)) kg kg**-1>,
     <CF Field: long_name=Potential vorticity(time(1), pressure(23), latitude(160), longitude(320)) K m**2 kg**-1 s**-1>,
     <CF Field: specific_humidity(time(1), pressure(23), latitude(160), longitude(320)) kg kg**-1>,
     <CF Field: relative_humidity(time(1), pressure(23), latitude(160), longitude(320)) %>,
     <CF Field: atmosphere_relative_vorticity(time(1), pressure(23), latitude(160), longitude(320)) m**2 s**-1>,
     <CF Field: air_temperature(time(1), pressure(23), latitude(160), longitude(320)) K>,
     <CF Field: eastward_wind(time(1), pressure(23), latitude(160), longitude(320)) m s**-1>,
     <CF Field: northward_wind(time(1), pressure(23), latitude(160), longitude(320)) m s**-1>,
     <CF Field: atmosphere_relative_vorticity(time(1), pressure(23), latitude(160), longitude(320)) s**-1>,
     <CF Field: divergence_of_wind(time(1), pressure(23), latitude(160), longitude(320)) m**2 s**-1>,
     <CF Field: vertical_air_velocity_expressed_as_tendency_of_pressure(time(1), pressure(23), latitude(160), longitude(320)) Pa s**-1>,
     <CF Field: geopotential(time(1), pressure(23), latitude(160), longitude(320)) m**2 s**-2>]




.. GENERATED FROM PYTHON SOURCE LINES 32-33

3. Set a bounding region for the data and discard readings outside of it:

.. GENERATED FROM PYTHON SOURCE LINES 33-40

.. code-block:: Python


    tl = (41, 72)  # (long, lat) of top left of bounding box.
    br = (65, 46)  # (long, lat) of bottom right of bounding box.

    U_region = U.subspace(X=cf.wi(tl[0], br[0]), Y=cf.wi(br[1], tl[1]))
    V_region = V.subspace(X=cf.wi(tl[0], br[0]), Y=cf.wi(br[1], tl[1]))








.. GENERATED FROM PYTHON SOURCE LINES 41-43

4. Select measurements for a specific pressure using the subspace method,
then use squeeze to remove the size 1 axis:

.. GENERATED FROM PYTHON SOURCE LINES 43-50

.. code-block:: Python


    U_sub = U_region.subspace(pressure=500.0)
    V_sub = V_region.subspace(pressure=500.0)

    U_sub.squeeze(inplace=True)
    V_sub.squeeze(inplace=True)








.. GENERATED FROM PYTHON SOURCE LINES 51-53

5. Calculate the magnitude of each resultant vector using Dask's hypot
function:

.. GENERATED FROM PYTHON SOURCE LINES 53-56

.. code-block:: Python


    magnitudes = da.hypot(U_sub.data, V_sub.data)








.. GENERATED FROM PYTHON SOURCE LINES 57-59

6. Calculate the angle of the resultant vector (relative to an Easterly ray)
using Dask's arctan2 function, then convert to a clockwise bearing:

.. GENERATED FROM PYTHON SOURCE LINES 59-64

.. code-block:: Python


    azimuths = da.arctan2(V_sub.data, U_sub.data)

    bearings = ((np.pi / 2) - azimuths) % (np.pi * 2)








.. GENERATED FROM PYTHON SOURCE LINES 65-66

7. Flatten the two dimensions of each array for plotting with Matplotlib:

.. GENERATED FROM PYTHON SOURCE LINES 66-71

.. code-block:: Python


    bearings_flattened = da.ravel(bearings)

    magnitudes_flattened = da.ravel(magnitudes)








.. GENERATED FROM PYTHON SOURCE LINES 72-73

8. Draw the scatter plot using Matplotlib:

.. GENERATED FROM PYTHON SOURCE LINES 73-79

.. code-block:: Python


    plt.figure(figsize=(5, 6))
    ax = plt.subplot(polar=True)
    ax.set_theta_zero_location("N")  # Place 0 degrees at the top.
    ax.set_theta_direction(-1)  # Arrange bearings clockwise around the plot.








.. GENERATED FROM PYTHON SOURCE LINES 86-89

9. Draw a scatter plot on the polar plot, using the wind direction bearing as
the angle and the magnitude of the resultant wind speed as the distance
from the pole.

.. GENERATED FROM PYTHON SOURCE LINES 89-91

.. code-block:: Python

    ax.scatter(bearings_flattened.compute(), magnitudes_flattened.compute(), s=1.2)








.. GENERATED FROM PYTHON SOURCE LINES 95-96

10. Label the axes and add a title.

.. GENERATED FROM PYTHON SOURCE LINES 96-111

.. code-block:: Python


    plt.title(
        f"Wind Rose Scatter Plot\nLat: {br[1]}°-{tl[1]}°, Long: {tl[0]}°-{br[0]}°"
    )

    ax.set_xlabel("Bearing [°]")

    ax.set_ylabel("Speed [m/s]", rotation=45, labelpad=30, size=8)

    ax.yaxis.set_label_coords(0.45, 0.45)

    ax.yaxis.set_tick_params(which="both", labelrotation=45, labelsize=8)

    ax.set_rlabel_position(45)








.. GENERATED FROM PYTHON SOURCE LINES 118-119

11. Display the plot.

.. GENERATED FROM PYTHON SOURCE LINES 119-121

.. code-block:: Python


    plt.show()



.. image-sg:: /recipes/images/sphx_glr_plot_22_recipe_001.png
   :alt: Wind Rose Scatter Plot Lat: 46°-72°, Long: 41°-65°
   :srcset: /recipes/images/sphx_glr_plot_22_recipe_001.png
   :class: sphx-glr-single-img






.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 0.255 seconds)


.. _sphx_glr_download_recipes_plot_22_recipe.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_22_recipe.ipynb <plot_22_recipe.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_22_recipe.py <plot_22_recipe.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: plot_22_recipe.zip <plot_22_recipe.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
