
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "recipes/plot_23_recipe.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_recipes_plot_23_recipe.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_recipes_plot_23_recipe.py:


Combining cf and Matplotlib plots in one figure
===============================================

Presently, cf-plot has very few exposed interfaces to its Matplotlib and
Cartopy backend. This makes it difficult to combine plots from the three
in one figure, but not impossible.

A combined cf and Matplotlib plot can be achieved by amending the figure
stored at ``cfp.plotvars.master_plot``, and then redrawing it with the
new subplots.

.. GENERATED FROM PYTHON SOURCE LINES 15-16

1. Import cf-python, cf-plot, Matplotlib, NumPy, and Dask.array:

.. GENERATED FROM PYTHON SOURCE LINES 16-25

.. code-block:: Python



    import matplotlib.pyplot as plt
    import cfplot as cfp
    import cf

    import numpy as np
    import dask.array as da








.. GENERATED FROM PYTHON SOURCE LINES 29-30

2. Read example data field constructs, and set region for our plots:

.. GENERATED FROM PYTHON SOURCE LINES 30-44

.. code-block:: Python


    f = cf.read(f"~/recipes/data1.nc")

    u = f.select_by_identity("eastward_wind")[0]
    v = f.select_by_identity("northward_wind")[0]
    t = f.select_by_identity("air_temperature")[0]

    # Subspace to get values for a specified pressure, here 500 mbar
    u = u.subspace(pressure=500)
    v = v.subspace(pressure=500)
    t = t.subspace(pressure=500)

    lonmin, lonmax, latmin, latmax = 10, 120, -30, 30



.. rst-class:: sphx-glr-script-out

.. code-block:: pytb

    Traceback (most recent call last):
      File "/home/slb93/git-repos/cf-python/docs/source/recipes/plot_23_recipe.py", line 31, in <module>
        f = cf.read(f"~/recipes/data1.nc")
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
      File "/home/slb93/miniconda3/envs/cf-env-312-numpy2/lib/python3.12/site-packages/cfdm/decorators.py", line 171, in verbose_override_wrapper
        return method_with_verbose_kwarg(*args, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
      File "/home/slb93/git-repos/cf-python/cf/read_write/read.py", line 528, in __new__
        return super().__new__(**kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^
      File "/home/slb93/miniconda3/envs/cf-env-312-numpy2/lib/python3.12/site-packages/cfdm/decorators.py", line 171, in verbose_override_wrapper
        return method_with_verbose_kwarg(*args, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
      File "/home/slb93/miniconda3/envs/cf-env-312-numpy2/lib/python3.12/site-packages/cfdm/read_write/read.py", line 282, in __new__
        for dataset in self._datasets():
      File "/home/slb93/miniconda3/envs/cf-env-312-numpy2/lib/python3.12/site-packages/cfdm/read_write/read.py", line 400, in _datasets
        raise FileNotFoundError(
    FileNotFoundError: No datasets found from datasets='~/recipes/data1.nc'




.. GENERATED FROM PYTHON SOURCE LINES 45-48

Outlining the figure with cf-plot
---------------------------------


.. GENERATED FROM PYTHON SOURCE LINES 51-52

1. Set desired dimensions for our final figure:

.. GENERATED FROM PYTHON SOURCE LINES 52-55

.. code-block:: Python


    rows, cols = 2, 2


.. GENERATED FROM PYTHON SOURCE LINES 56-58

2. Create a figure of set dimensions with ``cfp.gopen()``, then set the
position of the cf plot:

.. GENERATED FROM PYTHON SOURCE LINES 58-66

.. code-block:: Python



    cfp.gopen(rows, cols)

    pos = 2  # Second position in the figure

    cfp.gpos(pos)


.. GENERATED FROM PYTHON SOURCE LINES 70-71

3. Create a simple vector plot:

.. GENERATED FROM PYTHON SOURCE LINES 71-75

.. code-block:: Python


    cfp.mapset(lonmin=lonmin, lonmax=lonmax, latmin=latmin, latmax=latmax)
    cfp.vect(u=u, v=v, key_length=10, scale=120, stride=4)


.. GENERATED FROM PYTHON SOURCE LINES 76-79

Creating our Matplotlib plots
-----------------------------


.. GENERATED FROM PYTHON SOURCE LINES 82-83

1. Access the newly-created figure:

.. GENERATED FROM PYTHON SOURCE LINES 83-86

.. code-block:: Python


    fig = cfp.plotvars.master_plot


.. GENERATED FROM PYTHON SOURCE LINES 87-88

2. Reduce fields down to our test data for a wind rose scatter plot:

.. GENERATED FROM PYTHON SOURCE LINES 88-104

.. code-block:: Python


    # Limit to specific geographic region
    u_region = u.subspace(X=cf.wi(lonmin, lonmax), Y=cf.wi(latmin, latmax))
    v_region = v.subspace(X=cf.wi(lonmin, lonmax), Y=cf.wi(latmin, latmax))
    t_region = t.subspace(X=cf.wi(lonmin, lonmax), Y=cf.wi(latmin, latmax))

    # Remove size 1 axes
    u_squeeze = u_region.squeeze()
    v_squeeze = v_region.squeeze()
    t_squeeze = t_region.squeeze()

    # Flatten to one dimension for plot
    u_f = da.ravel(u_squeeze.data)
    v_f = da.ravel(v_squeeze.data)
    t_f = da.ravel(t_squeeze.data)


.. GENERATED FROM PYTHON SOURCE LINES 105-106

3. Perform calculations to create appropriate plot data:

.. GENERATED FROM PYTHON SOURCE LINES 106-115

.. code-block:: Python


    mag_f = da.hypot(u_f, v_f)  # Wind speed magnitude

    azimuths_f = da.arctan2(v_f, u_f)
    rad_f = ((np.pi / 2) - azimuths_f) % (np.pi * 2)  # Wind speed bearing

    # Normalise temperature data into a range appropriate for setting point sizes (1-10pt).
    temp_scaled = 1 + (t_f - t_f.min()) / (t_f.max() - t_f.min()) * (10 - 1)


.. GENERATED FROM PYTHON SOURCE LINES 116-117

4. Add Matplotlib subplot to our existing cf figure:

.. GENERATED FROM PYTHON SOURCE LINES 117-138

.. code-block:: Python


    pos = 1  # First position in the figure

    ax = fig.add_subplot(rows, cols, pos, polar=True)
    ax.set_theta_zero_location("N")
    ax.set_theta_direction(-1)

    ax.scatter(
        rad_f.compute(),
        mag_f.compute(),
        s=temp_scaled.compute(),
        c=temp_scaled.compute(),
        alpha=0.5,
    )

    ax.set_xlabel("Bearing [Â°]")
    ax.set_ylabel("Speed [m/s]", rotation=45, labelpad=30, size=8)
    ax.yaxis.set_label_coords(0.45, 0.45)
    ax.yaxis.set_tick_params(which="both", labelrotation=45, labelsize=8)
    ax.set_rlabel_position(45)


.. GENERATED FROM PYTHON SOURCE LINES 139-140

5. Create and add a third plot, for example:

.. GENERATED FROM PYTHON SOURCE LINES 140-151

.. code-block:: Python


    x = np.linspace(0, 10, 100)
    y = np.sin(x)

    pos = 3  # Third position in the figure

    ax1 = fig.add_subplot(rows, cols, pos)

    ax1.plot(x, y, label="sin(x)")
    ax1.legend()


.. GENERATED FROM PYTHON SOURCE LINES 152-155

Drawing the new figure
----------------------


.. GENERATED FROM PYTHON SOURCE LINES 158-159

1. Draw final figure:

.. GENERATED FROM PYTHON SOURCE LINES 159-164

.. code-block:: Python


    fig = plt.figure(fig)
    fig.tight_layout()
    fig.show()


.. GENERATED FROM PYTHON SOURCE LINES 165-172

Summary
-------

In summary, to use other plotting libraries with cf-plot, you must first
create your figure with cf-plot with placeholders for your other plots,
then add subplots by accessing the ``cfp.plotvars.master_plot`` object,
and finally redraw the figure containing the new plots.


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 0.001 seconds)


.. _sphx_glr_download_recipes_plot_23_recipe.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_23_recipe.ipynb <plot_23_recipe.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_23_recipe.py <plot_23_recipe.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: plot_23_recipe.zip <plot_23_recipe.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
