
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Statistical collapses &#8212; Documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script type="text/javascript" src="_static/copybutton.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><b><a href="index.html">cf 3.0.5</a></b></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html"><strong>Introduction</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="cf_data_model.html"><strong>CF data model</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html"><strong>Installation</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html"><strong>Tutorial</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="analysis.html"><strong>Analysis</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="api_reference.html"><strong>API reference</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="aggregation_rules.html"><strong>Aggregation rules</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="performance.html"><strong>Performance</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="releases.html"><strong>Older releases</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="Changelog.html"><strong>Change log</strong></a></li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/field_analysis.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="statistical-collapses">
<span id="id1"></span><h1><strong>Statistical collapses</strong><a class="headerlink" href="#statistical-collapses" title="Permalink to this headline">¶</a></h1>
<p>Collapsing one or more dimensions reduces their size and replaces the
data along those axes with representative statistical values. The
result is a new field construct with consistent metadata for the
collapsed values. Collapses are carried with the <a class="reference internal" href="method/cf.Field.collapse.html#cf.Field.collapse" title="cf.Field.collapse"><code class="xref py py-obj docutils literal notranslate"><span class="pre">collapse</span></code></a>
method of the field construct.</p>
<p>By default all axes with size greater than 1 are collapsed completely
(i.e. to size 1) with a given <a class="reference internal" href="tutorial.html#collapse-methods"><span class="std std-ref">collapse method</span></a>.</p>
<div class="literal-block-wrapper docutils container" id="id23">
<div class="code-block-caption"><span class="caption-text"><em>Find the minimum of the entire data.The file
timeseries.nc is found in the zip file of sample files):</em></span><a class="headerlink" href="#id23" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;timeseries.nc&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">Field: air_potential_temperature (ncvar%air_potential_temperature)</span>
<span class="go">------------------------------------------------------------------</span>
<span class="go">Data            : air_potential_temperature(time(120), latitude(5), longitude(8)) K</span>
<span class="go">Cell methods    : area: mean</span>
<span class="go">Dimension coords: time(120) = [1959-12-16 12:00:00, ..., 1969-11-16 00:00:00]</span>
<span class="go">                : latitude(5) = [-75.0, ..., 75.0] degrees_north</span>
<span class="go">                : longitude(8) = [22.5, ..., 337.5] degrees_east</span>
<span class="go">                : air_pressure(1) = [850.0] hPa</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;minimum&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="go">Field: air_potential_temperature (ncvar%air_potential_temperature)</span>
<span class="go">------------------------------------------------------------------</span>
<span class="go">Data            : air_potential_temperature(time(1), latitude(1), longitude(1)) K</span>
<span class="go">Cell methods    : area: mean time(1): latitude(1): longitude(1): minimum</span>
<span class="go">Dimension coords: time(1) = [1964-11-30 12:00:00]</span>
<span class="go">                : latitude(1) = [0.0] degrees_north</span>
<span class="go">                : longitude(1) = [180.0] degrees_east</span>
<span class="go">                : air_pressure(1) = [850.0] hPa</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[[[198.9]]]</span>
</pre></div>
</div>
</div>
<p>In the above example, note that the operation has been recorded in a
new cell method construct (<code class="docutils literal notranslate"><span class="pre">time(1):</span> <span class="pre">latitude(1):</span> <span class="pre">longitude(1):</span>
<span class="pre">minimum</span></code>) in the output field construct, and the dimension coordinate
constructs each now have a single cell. The air pressure time
dimension was not included in the collapse because it already had size
1 in the original field construct.</p>
<p>The collapse can also be applied to any subset of the field
construct’s dimensions. In this case, the domain axis and coordinate
constructs for the non-collapsed dimensions remain the same. This is
implemented either with the <em>axes</em> keyword, or with a <a class="reference external" href="http://cfconventions.org/Data/cf-conventions/cf-conventions-1.7/cf-conventions.html#cell-methods">CF-netCDF cell
methods</a>-like syntax for describing both the collapse dimensions
and the collapse method in a single string. The latter syntax uses
<a class="reference internal" href="tutorial.html#construct-identities"><span class="std std-ref">construct identities</span></a> instead of netCDF
dimension names to identify the collapse axes.</p>
<p>Statistics may be created to represent variation over one dimension or
a combination of dimensions.</p>
<div class="literal-block-wrapper docutils container" id="id24">
<div class="code-block-caption"><span class="caption-text"><em>Two equivalent techniques for creating a field construct
of temporal maxima at each horizontal location.</em></span><a class="headerlink" href="#id24" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;maximum&#39;</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;T: maximum&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="go">Field: air_potential_temperature (ncvar%air_potential_temperature)</span>
<span class="go">------------------------------------------------------------------</span>
<span class="go">Data            : air_potential_temperature(time(1), latitude(5), longitude(8)) K</span>
<span class="go">Cell methods    : area: mean time(1): maximum</span>
<span class="go">Dimension coords: time(1) = [1964-11-30 12:00:00]</span>
<span class="go">                : latitude(5) = [-75.0, ..., 75.0] degrees_north</span>
<span class="go">                : longitude(8) = [22.5, ..., 337.5] degrees_east</span>
<span class="go">                : air_pressure(1) = [850.0] hPa</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[[[310.6 309.1 309.9 311.2 310.4 310.1 310.7 309.6]</span>
<span class="go">  [310.  310.7 311.1 311.3 310.9 311.2 310.6 310. ]</span>
<span class="go">  [308.9 309.8 311.2 311.2 311.2 309.3 311.1 310.7]</span>
<span class="go">  [310.1 310.3 308.8 311.1 310.  311.3 311.2 309.7]</span>
<span class="go">  [310.9 307.9 310.3 310.4 310.8 310.9 311.3 309.3]]]</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id25">
<div class="code-block-caption"><span class="caption-text"><em>Find the horizontal maximum, with two equivalent
techniques.</em></span><a class="headerlink" href="#id25" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;maximum&#39;</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;X: Y: maximum&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="go">Field: air_potential_temperature (ncvar%air_potential_temperature)</span>
<span class="go">------------------------------------------------------------------</span>
<span class="go">Data            : air_potential_temperature(time(120), latitude(1), longitude(1)) K</span>
<span class="go">Cell methods    : area: mean latitude(1): longitude(1): maximum</span>
<span class="go">Dimension coords: time(120) = [1959-12-16 12:00:00, ..., 1969-11-16 00:00:00]</span>
<span class="go">                : latitude(1) = [0.0] degrees_north</span>
<span class="go">                : longitude(1) = [180.0] degrees_east</span>
<span class="go">                : air_pressure(1) = [850.0] hPa</span>
</pre></div>
</div>
</div>
<p>Variation over horizontal area may also be specified by the special
identity <code class="docutils literal notranslate"><span class="pre">'area'</span></code>. This may be used for any horizontal coordinate
reference system.</p>
<div class="literal-block-wrapper docutils container" id="id26">
<div class="code-block-caption"><span class="caption-text"><em>Find the horizontal maximum using the special identity
‘area’.</em></span><a class="headerlink" href="#id26" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;area: maximum&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="go">Field: air_potential_temperature (ncvar%air_potential_temperature)</span>
<span class="go">------------------------------------------------------------------</span>
<span class="go">Data            : air_potential_temperature(time(120), latitude(1), longitude(1)) K</span>
<span class="go">Cell methods    : area: mean area: maximum</span>
<span class="go">Dimension coords: time(120) = [1959-12-16 12:00:00, ..., 1969-11-16 00:00:00]</span>
<span class="go">                : latitude(1) = [0.0] degrees_north</span>
<span class="go">                : longitude(1) = [180.0] degrees_east</span>
<span class="go">                : air_pressure(1) = [850.0] hPa</span>
</pre></div>
</div>
</div>
<div class="section" id="collapse-methods">
<span id="id2"></span><h2>Collapse methods<a class="headerlink" href="#collapse-methods" title="Permalink to this headline">¶</a></h2>
<p>The following collapse methods are available, over any subset of the
domain axes. The “Cell method” column in the table gives the method of
the new cell method construct (if one is created).</p>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="43%" />
<col width="28%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Method</th>
<th class="head">Description</th>
<th class="head">Cell method</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">'maximum'</span></code></td>
<td>The maximum of the values.</td>
<td><code class="docutils literal notranslate"><span class="pre">maximum</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">'minimum'</span></code></td>
<td>The minimum of the values.</td>
<td><code class="docutils literal notranslate"><span class="pre">minimum</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">'maximum_absolute_value'</span></code></td>
<td>The maximum of the absolute values.</td>
<td><code class="docutils literal notranslate"><span class="pre">maximum_absolute_value</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">'minimum_absolute_value'</span></code></td>
<td>The minimum of the absolute values.</td>
<td><code class="docutils literal notranslate"><span class="pre">minimum_absolute_value</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">'mid_range'</span></code></td>
<td>The average of the maximum and the
minimum of the values.</td>
<td><code class="docutils literal notranslate"><span class="pre">mid_range</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">'range'</span></code></td>
<td>The absolute difference between the
maximum and the minimum of the values.</td>
<td><code class="docutils literal notranslate"><span class="pre">range</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">'median'</span></code></td>
<td>The median of the values.</td>
<td><code class="docutils literal notranslate"><span class="pre">median</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">'sample_size'</span></code></td>
<td>The sample size, <span class="math notranslate nohighlight">\(N\)</span>, as would be
used for other calculations, i.e. the
number of non-missing values.</td>
<td><code class="docutils literal notranslate"><span class="pre">point</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">'sum_of_weights'</span></code></td>
<td><p class="first">The sum of <span class="math notranslate nohighlight">\(N\)</span> weights
<span class="math notranslate nohighlight">\(w_i\)</span>, as would be used for other
calculations, is</p>
<div class="last math notranslate nohighlight">
\[V_{1}=\sum_{i=1}^{N} w_i\]</div>
</td>
<td><code class="docutils literal notranslate"><span class="pre">sum</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">'sum_of_weights2'</span></code></td>
<td><p class="first">The sum of the squares of <span class="math notranslate nohighlight">\(N\)</span>
weights <span class="math notranslate nohighlight">\(w_i\)</span>, as would be used
for other calculations, is</p>
<div class="last math notranslate nohighlight">
\[V_{2}=\sum_{i=1}^{N}  w_i^{2}\]</div>
</td>
<td><code class="docutils literal notranslate"><span class="pre">sum</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">'sum'</span></code></td>
<td><p class="first">The unweighted sum of <span class="math notranslate nohighlight">\(N\)</span> values
<span class="math notranslate nohighlight">\(x_i\)</span> is</p>
<div class="last math notranslate nohighlight">
\[t=\sum_{i=1}^{N} x_i\]</div>
</td>
<td><code class="docutils literal notranslate"><span class="pre">sum</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">'sum_of_squares'</span></code></td>
<td><p class="first">The unweighted sum of the squares of
<span class="math notranslate nohighlight">\(N\)</span> values <span class="math notranslate nohighlight">\(x_i\)</span> is</p>
<div class="last math notranslate nohighlight">
\[t_2=\sum_{i=1}^{N} x_{i}^{2}\]</div>
</td>
<td><code class="docutils literal notranslate"><span class="pre">sum_of_squares</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">'integral'</span></code></td>
<td><p class="first">The integral of <span class="math notranslate nohighlight">\(N\)</span> values
<span class="math notranslate nohighlight">\(x_i\)</span> with corresponding cell
measures <span class="math notranslate nohighlight">\(m_i\)</span> is</p>
<div class="math notranslate nohighlight">
\[i=\sum_{i=1}^{N} m_i x_i\]</div>
<p class="last">Note that the integral differs from a
weighted sum in that the units of the
cell measures are incorporated into the
result.</p>
</td>
<td><code class="docutils literal notranslate"><span class="pre">sum</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">'mean'</span></code></td>
<td><p class="first">The unweighted mean of <span class="math notranslate nohighlight">\(N\)</span> values
<span class="math notranslate nohighlight">\(x_i\)</span> is</p>
<div class="math notranslate nohighlight">
\[\mu=\frac{1}{N}\sum_{i=1}^{N}
x_i\]</div>
<p>The <a class="reference internal" href="tutorial.html#collapse-weights"><span class="std std-ref">weighted</span></a>
mean of <span class="math notranslate nohighlight">\(N\)</span> values <span class="math notranslate nohighlight">\(x_i\)</span>
with corresponding weights <span class="math notranslate nohighlight">\(w_i\)</span>
is</p>
<div class="last math notranslate nohighlight">
\[\hat{\mu}=\frac{1}{V_{1}}
           \sum_{i=1}^{N}
w_i x_i\]</div>
</td>
<td><code class="docutils literal notranslate"><span class="pre">mean</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">'mean_absolute_value'</span></code></td>
<td><p class="first">The unweighted mean of <span class="math notranslate nohighlight">\(N\)</span>
values <span class="math notranslate nohighlight">\(x_i\)</span> absoluted is</p>
<div class="math notranslate nohighlight">
\[\mu_{abs}=\frac{1}{N}
\sum_{i=1}^{N}|x_i|\]</div>
<p>The <a class="reference internal" href="tutorial.html#collapse-weights"><span class="std std-ref">weighted</span></a>
mean of <span class="math notranslate nohighlight">\(N\)</span> values <span class="math notranslate nohighlight">\(x_i\)</span>
absoluted with corresponding weights
<span class="math notranslate nohighlight">\(w_i\)</span> is</p>
<div class="last math notranslate nohighlight">
\[\hat{\mu}_{abs}=
\frac{1}{V_{1}}
\sum_{i=1}^{N} w_i |x_i|\]</div>
</td>
<td><code class="docutils literal notranslate"><span class="pre">mean_absolute_value</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">'mean_of_upper_decile'</span></code></td>
<td>The weighted or unweighted mean of the
upper group of data values defined by
the upper tenth of their distribution</td>
<td><code class="docutils literal notranslate"><span class="pre">mean_of_upper_decile</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">'variance'</span></code></td>
<td><p class="first">The unweighted variance of <span class="math notranslate nohighlight">\(N\)</span>
values <span class="math notranslate nohighlight">\(x_i\)</span> and with
<span class="math notranslate nohighlight">\(N-ddof\)</span> degrees of freedom
(<span class="math notranslate nohighlight">\(ddof\ge0\)</span>) is</p>
<div class="math notranslate nohighlight">
\[s_{N-ddof}^{2}=
\frac{1}{N-ddof}
\sum_{i=1}^{N} (x_i - \mu)^2\]</div>
<p>The unweighted biased estimate of the
variance (<span class="math notranslate nohighlight">\(s_{N}^{2}\)</span>) is given by
<span class="math notranslate nohighlight">\(ddof=0\)</span> and the unweighted
unbiased estimate of the variance using
Bessel’s correction
(<span class="math notranslate nohighlight">\(s^{2}=s_{N-1}^{2}\)</span>) is given by
<span class="math notranslate nohighlight">\(ddof=1\)</span>.</p>
<p>The <a class="reference internal" href="tutorial.html#collapse-weights"><span class="std std-ref">weighted</span></a>
biased estimate of the variance of
<span class="math notranslate nohighlight">\(N\)</span> values <span class="math notranslate nohighlight">\(x_i\)</span> with
corresponding weights <span class="math notranslate nohighlight">\(w_i\)</span> is</p>
<div class="math notranslate nohighlight">
\[\hat{s}_{N}^{2}=
\frac{1}{V_{1}}
\sum_{i=1}^{N}
w_i(x_i -
\hat{\mu})^{2}\]</div>
<p>The corresponding <a class="reference internal" href="tutorial.html#collapse-weights"><span class="std std-ref">weighted</span></a> unbiased estimate of
the variance is</p>
<div class="math notranslate nohighlight">
\[\hat{s}^{2}=\frac{1}{V_{1} -
(V_{1}/V_{2})}
\sum_{i=1}^{N}
w_i(x_i -
\hat{\mu})^{2}\]</div>
<p class="last">In both cases, the weights are assumed
to be non-random reliability weights, as
opposed to frequency weights.</p>
</td>
<td><code class="docutils literal notranslate"><span class="pre">variance</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">'standard_deviation'</span></code></td>
<td>The standard deviation is the square
root of the unweighted or
<a class="reference internal" href="tutorial.html#collapse-weights"><span class="std std-ref">weighted</span></a>
variance, as defined in this table.</td>
<td><code class="docutils literal notranslate"><span class="pre">standard_deviation</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">'root_mean_square'</span></code></td>
<td><p class="first">The unweighted root mean square of
<span class="math notranslate nohighlight">\(N\)</span> values <span class="math notranslate nohighlight">\(x_i\)</span> is</p>
<div class="math notranslate nohighlight">
\[RMS=\sqrt{\frac{1}{N}
\sum_{i=1}^{N}
x_{i}^2}\]</div>
<p>The <a class="reference internal" href="tutorial.html#collapse-weights"><span class="std std-ref">weighted</span></a>
root mean square of <span class="math notranslate nohighlight">\(N\)</span> values
<span class="math notranslate nohighlight">\(x_i\)</span> with corresponding weights
<span class="math notranslate nohighlight">\(w_i\)</span> is</p>
<div class="last math notranslate nohighlight">
\[\hat{RMS}=\sqrt{
\frac{1}{V_{1}}
\sum_{i=1}^{N} w_i
x_{i}^2}\]</div>
</td>
<td><code class="docutils literal notranslate"><span class="pre">root_mean_square</span></code></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="data-type-and-missing-data">
<span id="id3"></span><h2>Data type and missing data<a class="headerlink" href="#data-type-and-missing-data" title="Permalink to this headline">¶</a></h2>
<p>In all collapses, missing data array elements are accounted for in the
calculation.</p>
<p>Any collapse method that involves a calculation (such as calculating a
mean), as opposed to just selecting a value (such as finding a
maximum), will return a field containing double precision floating
point numbers. If this is not desired then the data type can be reset
after the collapse with the <a class="reference internal" href="attribute/cf.Field.dtype.html#cf.Field.dtype" title="cf.Field.dtype"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dtype</span></code></a> attribute of the field
construct.</p>
</div>
<div class="section" id="collapse-weights">
<span id="id4"></span><h2>Collapse weights<a class="headerlink" href="#collapse-weights" title="Permalink to this headline">¶</a></h2>
<p>For weights to be incorporated in the collapse, the axes to be
weighted must be identified with the <em>weights</em> keyword. A collapse by
a particular method is either never weighted, or may be weighted, or
is always weighted, as described in the following table:</p>
<table border="1" class="docutils">
<colgroup>
<col width="44%" />
<col width="44%" />
<col width="13%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Method</th>
<th class="head">Description</th>
<th class="head">Weighted</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">'maximum'</span></code></td>
<td>The maximum of the values.</td>
<td>Never</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">'minimum'</span></code></td>
<td>The minimum of the values.</td>
<td>Never</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">'maximum_absolute_value'</span></code></td>
<td>The maximum of the absolute.</td>
<td>Never</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">'minimum_absolute_value'</span></code></td>
<td>The minimum of the absolute.</td>
<td>Never</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">'mid_range'</span></code></td>
<td>The average of the maximum
and the minimum of the
values.</td>
<td>Never</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">'range'</span></code></td>
<td>The absolute difference
between the maximum and the
minimum of the values.</td>
<td>Never</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">'median'</span></code></td>
<td>The median of the values.</td>
<td>Never</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">'sum'</span></code></td>
<td>The sum of the values.</td>
<td>Never</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">'sum_of_squares'</span></code></td>
<td>The sum of the squares of
values.</td>
<td>Never</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">'sample_size'</span></code></td>
<td>The sample size, i.e. the
number of non-missing
values.</td>
<td>Never</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">'sum_of_weights'</span></code></td>
<td>The sum of weights, as
would be used for other
calculations.</td>
<td>Never</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">'sum_of_weights2'</span></code></td>
<td>The sum of squares of
weights, as would be used
for other calculations.</td>
<td>Never</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">'mean'</span></code></td>
<td>The weighted or unweighted
mean of the values.</td>
<td>May be</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">'mean_absolute_value'</span></code></td>
<td>The mean of the absolute
values.</td>
<td>May be</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">'mean_of_upper_decile'</span></code></td>
<td>The mean of the upper group
of data values defined by
the upper tenth of their
distribution.</td>
<td>May be</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">'variance'</span></code></td>
<td>The weighted or unweighted
variance of the values, with
a given number of degrees of
freedom.</td>
<td>May be</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">'standard_deviation'</span></code></td>
<td>The square root of the
weighted or unweighted
variance.</td>
<td>May be</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">'root_mean_square'</span></code></td>
<td>The square root of the
weighted or unweighted mean
of the squares of the
values.</td>
<td>May be</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">'integral'</span></code></td>
<td>The integral of values.</td>
<td>Always</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Collapse methods that are “Never” weighted ignore the <em>weights</em>
parameter, even if it is set.</li>
<li>Collapse methods that “May be” weighted will only be weighted if the
<em>weights</em> parameter is set.</li>
<li>Collapse methods that are “Always” weighted require the <em>weights</em>
parameter to be set.</li>
</ul>
<p>Weights are either derived from the field construct’s metadata (such
as cell sizes), or may be provided explicitly in the form of other
field constructs containing data of weights values. In either case,
the weights actually used are those derived by the <a class="reference internal" href="method/cf.Field.weights.html#cf.Field.weights" title="cf.Field.weights"><code class="xref py py-obj docutils literal notranslate"><span class="pre">weights</span></code></a>
method of the field construct called with the same <em>weights</em> keyword
value. Collapsed axes that are not identified by the <em>weights</em> keyword
are unweighted during the collapse operation.</p>
<div class="literal-block-wrapper docutils container" id="id27">
<div class="code-block-caption"><span class="caption-text"><em>Create a weighted time average.</em></span><a class="headerlink" href="#id27" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;T: mean&#39;</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="go">Field: air_potential_temperature (ncvar%air_potential_temperature)</span>
<span class="go">------------------------------------------------------------------</span>
<span class="go">Data            : air_potential_temperature(time(1), latitude(5), longitude(8)) K</span>
<span class="go">Cell methods    : area: mean time(1): mean</span>
<span class="go">Dimension coords: time(1) = [1964-11-30 12:00:00]</span>
<span class="go">                : latitude(5) = [-75.0, ..., 75.0] degrees_north</span>
<span class="go">                : longitude(8) = [22.5, ..., 337.5] degrees_east</span>
<span class="go">                : air_pressure(1) = [850.0] hPa</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[[[254.03120723 255.89723515 253.06490556 254.17815494 255.18458801 253.3684369  253.26624692 253.63818779]</span>
<span class="go">  [248.92058582 253.99597591 259.67957843 257.08967972 252.57333698 252.5746236  258.90938954 253.86939502]</span>
<span class="go">  [255.94716671 254.77330961 254.35929373 257.91478237 251.87670408 252.72723789 257.26038872 258.19698878]</span>
<span class="go">  [258.08639474 254.8087873  254.9881741  250.98064604 255.3513003  256.66337257 257.86895702 259.49299206]</span>
<span class="go">  [263.80016425 253.35825349 257.8026006  254.3173556  252.2061867  251.74150014 255.60930742 255.06260608]]]</span>
</pre></div>
</div>
</div>
<p>To inspect the weights, call the  <a class="reference internal" href="method/cf.Field.weights.html#cf.Field.weights" title="cf.Field.weights"><code class="xref py py-obj docutils literal notranslate"><span class="pre">weights</span></code></a> method directly.</p>
<div class="literal-block-wrapper docutils container" id="id28">
<div class="code-block-caption"><span class="caption-text"><em>TODO</em></span><a class="headerlink" href="#id28" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">w</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">weights</span><span class="p">(</span><span class="n">weights</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
<span class="go">Field: long_name=weights (ncvar%air_potential_temperature)</span>
<span class="go">----------------------------------------------------------</span>
<span class="go">Data            : long_name=weights(time(120)) d</span>
<span class="go">Dimension coords: time(120) = [1959-12-16 12:00:00, ..., 1969-11-16 00:00:00]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[31. 31. 29. 31. 30. 31. 30. 31. 31. 30. 31. 30. 31. 31. 28. 31. 30. 31.</span>
<span class="go"> 30. 31. 31. 30. 31. 30. 31. 31. 28. 31. 30. 31. 30. 31. 31. 30. 31. 30.</span>
<span class="go"> 31. 31. 28. 31. 30. 31. 30. 31. 31. 30. 31. 30. 31. 31. 29. 31. 30. 31.</span>
<span class="go"> 30. 31. 31. 30. 31. 30. 31. 31. 28. 31. 30. 31. 30. 31. 31. 30. 31. 30.</span>
<span class="go"> 31. 31. 28. 31. 30. 31. 30. 31. 31. 30. 31. 30. 31. 31. 28. 31. 30. 31.</span>
<span class="go"> 30. 31. 31. 30. 31. 30. 31. 31. 29. 31. 30. 31. 30. 31. 31. 30. 31. 30.</span>
<span class="go"> 31. 31. 28. 31. 30. 31. 30. 31. 31. 30. 31. 30.]</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id29">
<div class="code-block-caption"><span class="caption-text"><em>Calculate the mean over the time and latitude axes, with
weights only applied to the latitude axis.</em></span><a class="headerlink" href="#id29" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;T: Y: mean&#39;</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="go">Field: air_potential_temperature (ncvar%air_potential_temperature)</span>
<span class="go">------------------------------------------------------------------</span>
<span class="go">Data            : air_potential_temperature(time(1), latitude(1), longitude(8)) K</span>
<span class="go">Cell methods    : area: mean time(1): latitude(1): mean</span>
<span class="go">Dimension coords: time(1) = [1964-11-30 12:00:00]</span>
<span class="go">                : latitude(1) = [0.0] degrees_north</span>
<span class="go">                : longitude(8) = [22.5, ..., 337.5] degrees_east</span>
<span class="go">                : air_pressure(1) = [850.0] hPa</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[[[256.15819444 254.625      255.73666667 255.43041667 253.19444444 253.31277778 256.68236111 256.42055556]]]</span>
</pre></div>
</div>
</div>
<p>Specifying weighting by horizontal cell area may also use the special
<code class="docutils literal notranslate"><span class="pre">'area'</span></code> syntax.</p>
<div class="literal-block-wrapper docutils container" id="id30">
<div class="code-block-caption"><span class="caption-text"><em>Alternative syntax for specifying area weights.</em></span><a class="headerlink" href="#id30" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;area: mean&#39;</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="s1">&#39;area&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="go">Field: air_potential_temperature (ncvar%air_potential_temperature)</span>
<span class="go">------------------------------------------------------------------</span>
<span class="go">Data            : air_potential_temperature(time(120), latitude(1), longitude(1)) K</span>
<span class="go">Cell methods    : area: mean area: mean</span>
<span class="go">Dimension coords: time(120) = [1959-12-16 12:00:00, ..., 1969-11-16 00:00:00]</span>
<span class="go">                : latitude(1) = [0.0] degrees_north</span>
<span class="go">                : longitude(1) = [180.0] degrees_east</span>
<span class="go">                : air_pressure(1) = [850.0] hPa</span>
</pre></div>
</div>
</div>
<p>See the <a class="reference internal" href="method/cf.Field.weights.html#cf.Field.weights" title="cf.Field.weights"><code class="xref py py-obj docutils literal notranslate"><span class="pre">weights</span></code></a> method for full details on how weights may be specified.</p>
</div>
<div class="section" id="multiple-collapses">
<span id="id5"></span><h2>Multiple collapses<a class="headerlink" href="#multiple-collapses" title="Permalink to this headline">¶</a></h2>
<p>Multiple collapses normally require multiple calls to
<a class="reference internal" href="method/cf.Field.collapse.html#cf.Field.collapse" title="cf.Field.collapse"><code class="xref py py-obj docutils literal notranslate"><span class="pre">collapse</span></code></a>: one on the original field construct and then one on
each interim field construct.</p>
<div class="literal-block-wrapper docutils container" id="id31">
<div class="code-block-caption"><span class="caption-text"><em>Calculate the temporal maximum of the weighted areal
means using two independent calls.</em></span><a class="headerlink" href="#id31" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;area: mean&#39;</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="s1">&#39;area&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;T: maximum&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="go">Field: air_potential_temperature (ncvar%air_potential_temperature)</span>
<span class="go">------------------------------------------------------------------</span>
<span class="go">Data            : air_potential_temperature(time(1), latitude(1), longitude(1)) K</span>
<span class="go">Cell methods    : area: mean latitude(1): longitude(1): mean time(1): maximum</span>
<span class="go">Dimension coords: time(1) = [1964-11-30 12:00:00]</span>
<span class="go">                : latitude(1) = [0.0] degrees_north</span>
<span class="go">                : longitude(1) = [180.0] degrees_east</span>
<span class="go">                : air_pressure(1) = [850.0] hPa</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[[[271.77199724]]]</span>
</pre></div>
</div>
</div>
<p>If preferred, multiple collapses may be carried out in a single call
to <a class="reference internal" href="method/cf.Field.collapse.html#cf.Field.collapse" title="cf.Field.collapse"><code class="xref py py-obj docutils literal notranslate"><span class="pre">collapse</span></code></a> by using the <a class="reference external" href="http://cfconventions.org/Data/cf-conventions/cf-conventions-1.7/cf-conventions.html#cell-methods">CF-netCDF cell methods</a>-like
syntax (note that the colon (<code class="docutils literal notranslate"><span class="pre">:</span></code>) is only used after the construct
identity that specifies each axis, and a space delimits the separate
collapses).</p>
<div class="literal-block-wrapper docutils container" id="id32">
<div class="code-block-caption"><span class="caption-text"><em>Calculate the temporal maximum of the weighted areal
means in a single call, using the cf-netCDF cell
methods-like syntax.</em></span><a class="headerlink" href="#id32" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;area: mean T: maximum&#39;</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="s1">&#39;area&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[[[271.77199724]]]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="grouped-collapses">
<span id="id6"></span><h2>Grouped collapses<a class="headerlink" href="#grouped-collapses" title="Permalink to this headline">¶</a></h2>
<p>A grouped collapse is one for which an axis is not collapsed
completely to size 1. Instead the collapse axis is partitioned into
groups and each group is collapsed to size 1. The resulting axis will
generally have more than one element. For example, creating 12 annual
means from a timeseries of 120 months would be a grouped collapse. The
groups do not need to be created from adjacent cells, as would be the
case when creating 12 multi-annual monthly means from a timeseries of
120 months.</p>
<p>The <em>group</em> keyword of <a class="reference internal" href="method/cf.Field.collapse.html#cf.Field.collapse" title="cf.Field.collapse"><code class="xref py py-obj docutils literal notranslate"><span class="pre">collapse</span></code></a> defines the size of the
groups. Groups can be defined in a variety of ways, including with
<a class="reference internal" href="classes/cf.Query.html#cf.Query" title="cf.Query"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cf.Query</span></code></a>, <a class="reference internal" href="classes/cf.TimeDuration.html#cf.TimeDuration" title="cf.TimeDuration"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cf.TimeDuration</span></code></a> (see the <a class="reference internal" href="tutorial.html#time-duration"><span class="std std-ref">Time duration</span></a> section)
and <a class="reference internal" href="classes/cf.Data.html#cf.Data" title="cf.Data"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cf.Data</span></code></a> instances.</p>
<p>Not every element of the collapse axis needs to be in group. Elements
that are not selected by the <em>group</em> keyword are excluded from the
result.</p>
<div class="literal-block-wrapper docutils container" id="id33">
<div class="code-block-caption"><span class="caption-text"><em>Create annual maxima from a time series, defining a year
to start on 1st January.</em></span><a class="headerlink" href="#id33" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="n">month</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span>
<span class="go">&lt;CF TimeDuration: P1Y (Y-12-01 00:00:00)&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;T: maximum&#39;</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="go">Field: air_potential_temperature (ncvar%air_potential_temperature)</span>
<span class="go">------------------------------------------------------------------</span>
<span class="go">Data            : air_potential_temperature(time(10), latitude(5), longitude(8)) K</span>
<span class="go">Cell methods    : area: mean time(10): maximum</span>
<span class="go">Dimension coords: time(10) = [1960-06-01 00:00:00, ..., 1969-06-01 12:00:00]</span>
<span class="go">                : latitude(5) = [-75.0, ..., 75.0] degrees_north</span>
<span class="go">                : longitude(8) = [22.5, ..., 337.5] degrees_east</span>
<span class="go">                : air_pressure(1) = [850.0] hPa</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id34">
<div class="code-block-caption"><span class="caption-text"><em>Find the maximum of each group of 6 elements along an
axis.</em></span><a class="headerlink" href="#id34" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;T: maximum&#39;</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="go">Field: air_potential_temperature (ncvar%air_potential_temperature)</span>
<span class="go">------------------------------------------------------------------</span>
<span class="go">Data            : air_potential_temperature(time(20), latitude(5), longitude(8)) K</span>
<span class="go">Cell methods    : area: mean time(20): maximum</span>
<span class="go">Dimension coords: time(20) = [1960-03-01 12:00:00, ..., 1969-08-31 12:00:00]</span>
<span class="go">                : latitude(5) = [-75.0, ..., 75.0] degrees_north</span>
<span class="go">                : longitude(8) = [22.5, ..., 337.5] degrees_east</span>
<span class="go">                : air_pressure(1) = [850.0] hPa</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id35">
<div class="code-block-caption"><span class="caption-text"><em>Create December, January, February maxima from a time series.</em></span><a class="headerlink" href="#id35" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;T: maximum&#39;</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">cf</span><span class="o">.</span><span class="n">djf</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="go">Field: air_potential_temperature (ncvar%air_potential_temperature)</span>
<span class="go">------------------------------------------------------------------</span>
<span class="go">Data            : air_potential_temperature(time(10), latitude(5), longitude(8)) K</span>
<span class="go">Cell methods    : area: mean time(10): maximum time(10): maximum</span>
<span class="go">Dimension coords: time(10) = [1960-01-15 12:00:00, ..., 1969-01-15 00:00:00]</span>
<span class="go">                : latitude(5) = [-75.0, ..., 75.0] degrees_north</span>
<span class="go">                : longitude(8) = [22.5, ..., 337.5] degrees_east</span>
<span class="go">                : air_pressure(1) = [850.0] hPa</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id36">
<div class="code-block-caption"><span class="caption-text"><em>Create maxima for each 3-month season of a timeseries
(DJF, MAM, JJA, SON).</em></span><a class="headerlink" href="#id36" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">seasons</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span>
<span class="go">[&lt;CF Query: month[(ge 12) | (le 2)]&gt;</span>
<span class="go"> &lt;CF Query: month(wi (3, 5))&gt;,</span>
<span class="go"> &lt;CF Query: month(wi (6, 8))&gt;,</span>
<span class="go"> &lt;CF Query: month(wi (9, 11))&gt;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;T: maximum&#39;</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="go">Field: air_potential_temperature (ncvar%air_potential_temperature)</span>
<span class="go">------------------------------------------------------------------</span>
<span class="go">Data            : air_potential_temperature(time(40), latitude(5), longitude(8)) K</span>
<span class="go">Cell methods    : area: mean time(40): maximum time(40): maximum</span>
<span class="go">Dimension coords: time(40) = [1960-01-15 12:00:00, ..., 1969-10-16 12:00:00]</span>
<span class="go">                : latitude(5) = [-75.0, ..., 75.0] degrees_north</span>
<span class="go">                : longitude(8) = [22.5, ..., 337.5] degrees_east</span>
<span class="go">                : air_pressure(1) = [850.0] hPa</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id37">
<div class="code-block-caption"><span class="caption-text"><em>Calculate zonal means for the western and eastern
hemispheres.</em></span><a class="headerlink" href="#id37" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;X: mean&#39;</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="mi">180</span><span class="p">,</span> <span class="s1">&#39;degrees&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="go">Field: air_potential_temperature (ncvar%air_potential_temperature)</span>
<span class="go">------------------------------------------------------------------</span>
<span class="go">Data            : air_potential_temperature(time(120), latitude(5), longitude(2)) K</span>
<span class="go">Cell methods    : area: mean longitude(2): mean longitude(2): mean</span>
<span class="go">Dimension coords: time(120) = [1959-12-16 12:00:00, ..., 1969-11-16 00:00:00]</span>
<span class="go">                : latitude(5) = [-75.0, ..., 75.0] degrees_north</span>
<span class="go">                : longitude(2) = [90.0, 270.0] degrees_east</span>
<span class="go">                : air_pressure(1) = [850.0] hPa</span>
</pre></div>
</div>
</div>
<p>Groups can be further described with the <em>group_span</em> (to ignore
groups whose actual span is less than a given value) and
<em>group_contiguous</em> (to ignore non-contiguous groups, or any contiguous
group containing overlapping cells) keywords of <a class="reference internal" href="method/cf.Field.collapse.html#cf.Field.collapse" title="cf.Field.collapse"><code class="xref py py-obj docutils literal notranslate"><span class="pre">collapse</span></code></a>.</p>
</div>
<div class="section" id="climatological-statistics">
<span id="id7"></span><h2>Climatological statistics<a class="headerlink" href="#climatological-statistics" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://cfconventions.org/Data/cf-conventions/cf-conventions-1.7/cf-conventions.html#climatological-statistics">Climatological statistics</a> may be derived from corresponding
portions of the annual cycle in a set of years (e.g. the average
January temperatures in the climatology of 1961-1990, where the values
are derived by averaging the 30 Januarys from the separate years); or
from corresponding portions of the diurnal cycle in a set of days
(e.g. the average temperatures for each hour in the day for May
1997). A diurnal climatology may also be combined with a multiannual
climatology (e.g. the minimum temperature for each hour of the average
day in May from a 1961-1990 climatology).</p>
<p>Calculation requires two or three collapses, depending on the quantity
being created, all of which are grouped collapses. Each collapse
method needs to indicate its climatological nature with one of the
following qualifiers,</p>
<table border="1" class="docutils">
<colgroup>
<col width="41%" />
<col width="59%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Method qualifier</th>
<th class="head">Associated keyword</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">within</span> <span class="pre">years</span></code></td>
<td><em>within_years</em></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">within</span> <span class="pre">days</span></code></td>
<td><em>within_days</em></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">over</span> <span class="pre">years</span></code></td>
<td><em>over_years</em> (optional)</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">over</span> <span class="pre">days</span></code></td>
<td><em>over_days</em> (optional)</td>
</tr>
</tbody>
</table>
<p>and the associated keyword to <a class="reference internal" href="method/cf.Field.collapse.html#cf.Field.collapse" title="cf.Field.collapse"><code class="xref py py-obj docutils literal notranslate"><span class="pre">collapse</span></code></a> specifies how the
method is to be applied.</p>
<div class="literal-block-wrapper docutils container" id="id38">
<div class="code-block-caption"><span class="caption-text"><em>Calculate the multiannual average of the seasonal means.</em></span><a class="headerlink" href="#id38" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;T: mean within years T: mean over years&#39;</span><span class="p">,</span>
<span class="gp">... </span>               <span class="n">within_years</span><span class="o">=</span><span class="n">cf</span><span class="o">.</span><span class="n">seasons</span><span class="p">(),</span> <span class="n">weights</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="go">Field: air_potential_temperature (ncvar%air_potential_temperature)</span>
<span class="go">------------------------------------------------------------------</span>
<span class="go">Data            : air_potential_temperature(time(4), latitude(5), longitude(8)) K</span>
<span class="go">Cell methods    : area: mean time(4): mean within years time(4): mean over years</span>
<span class="go">Dimension coords: time(4) = [1960-01-15 12:00:00, ..., 1960-10-16 12:00:00]</span>
<span class="go">                : latitude(5) = [-75.0, ..., 75.0] degrees_north</span>
<span class="go">                : longitude(8) = [22.5, ..., 337.5] degrees_east</span>
<span class="go">                : air_pressure(1) = [850.0] hPa</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">coordinate</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">datetime_array</span><span class="p">)</span>
<span class="go">[[cftime.DatetimeGregorian(1959-12-01 00:00:00) cftime.DatetimeGregorian(1969-03-01 00:00:00)]</span>
<span class="go"> [cftime.DatetimeGregorian(1960-03-01 00:00:00) cftime.DatetimeGregorian(1969-06-01 00:00:00)]</span>
<span class="go"> [cftime.DatetimeGregorian(1960-06-01 00:00:00) cftime.DatetimeGregorian(1969-09-01 00:00:00)]</span>
<span class="go"> [cftime.DatetimeGregorian(1960-09-01 00:00:00) cftime.DatetimeGregorian(1969-12-01 00:00:00)]]</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id39">
<div class="code-block-caption"><span class="caption-text"><em>Calculate the multiannual variance of the seasonal
minima. Note that the units of the result have been
changed from ‘K’ to ‘K2’.</em></span><a class="headerlink" href="#id39" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;T: minimum within years T: variance over years&#39;</span><span class="p">,</span>
<span class="gp">... </span>               <span class="n">within_years</span><span class="o">=</span><span class="n">cf</span><span class="o">.</span><span class="n">seasons</span><span class="p">(),</span> <span class="n">weights</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="go">Field: air_potential_temperature (ncvar%air_potential_temperature)</span>
<span class="go">------------------------------------------------------------------</span>
<span class="go">Data            : air_potential_temperature(time(4), latitude(5), longitude(8)) K2</span>
<span class="go">Cell methods    : area: mean time(4): minimum within years time(4): variance over years</span>
<span class="go">Dimension coords: time(4) = [1960-01-15 12:00:00, ..., 1960-10-16 12:00:00]</span>
<span class="go">                : latitude(5) = [-75.0, ..., 75.0] degrees_north</span>
<span class="go">                : longitude(8) = [22.5, ..., 337.5] degrees_east</span>
<span class="go">                : air_pressure(1) = [850.0] hPa</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">coordinate</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">datetime_array</span><span class="p">)</span>
<span class="go">[[cftime.DatetimeGregorian(1959-12-01 00:00:00) cftime.DatetimeGregorian(1969-03-01 00:00:00)]</span>
<span class="go"> [cftime.DatetimeGregorian(1960-03-01 00:00:00) cftime.DatetimeGregorian(1969-06-01 00:00:00)]</span>
<span class="go"> [cftime.DatetimeGregorian(1960-06-01 00:00:00) cftime.DatetimeGregorian(1969-09-01 00:00:00)]</span>
<span class="go"> [cftime.DatetimeGregorian(1960-09-01 00:00:00) cftime.DatetimeGregorian(1969-12-01 00:00:00)]]</span>
</pre></div>
</div>
</div>
<p>When collapsing over years, it is assumed by default that the each
portion of the annual cycle is collapsed over all years that are
present. This is the case in the above two examples. It is possible,
however, to restrict the years to be included, or group them into
chunks, with the <em>over_years</em> keyword to <a class="reference internal" href="method/cf.Field.collapse.html#cf.Field.collapse" title="cf.Field.collapse"><code class="xref py py-obj docutils literal notranslate"><span class="pre">collapse</span></code></a>.</p>
<div class="literal-block-wrapper docutils container" id="id40">
<div class="code-block-caption"><span class="caption-text"><em>Calculate the multiannual average of the seasonal means
in 5 year chunks.</em></span><a class="headerlink" href="#id40" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;T: mean within years T: mean over years&#39;</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">,</span>
<span class="gp">... </span>               <span class="n">within_years</span><span class="o">=</span><span class="n">cf</span><span class="o">.</span><span class="n">seasons</span><span class="p">(),</span> <span class="n">over_years</span><span class="o">=</span><span class="n">cf</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="go">Field: air_potential_temperature (ncvar%air_potential_temperature)</span>
<span class="go">------------------------------------------------------------------</span>
<span class="go">Data            : air_potential_temperature(time(8), latitude(5), longitude(8)) K</span>
<span class="go">Cell methods    : area: mean time(8): mean within years time(8): mean over years</span>
<span class="go">Dimension coords: time(8) = [1960-01-15 12:00:00, ..., 1965-10-16 12:00:00]</span>
<span class="go">                : latitude(5) = [-75.0, ..., 75.0] degrees_north</span>
<span class="go">                : longitude(8) = [22.5, ..., 337.5] degrees_east</span>
<span class="go">                : air_pressure(1) = [850.0] hPa</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">coordinate</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">datetime_array</span><span class="p">)</span>
<span class="go">[[cftime.DatetimeGregorian(1959-12-01 00:00:00) cftime.DatetimeGregorian(1964-03-01 00:00:00)]</span>
<span class="go"> [cftime.DatetimeGregorian(1960-03-01 00:00:00) cftime.DatetimeGregorian(1964-06-01 00:00:00)]</span>
<span class="go"> [cftime.DatetimeGregorian(1960-06-01 00:00:00) cftime.DatetimeGregorian(1964-09-01 00:00:00)]</span>
<span class="go"> [cftime.DatetimeGregorian(1960-09-01 00:00:00) cftime.DatetimeGregorian(1964-12-01 00:00:00)]</span>
<span class="go"> [cftime.DatetimeGregorian(1964-12-01 00:00:00) cftime.DatetimeGregorian(1969-03-01 00:00:00)]</span>
<span class="go"> [cftime.DatetimeGregorian(1965-03-01 00:00:00) cftime.DatetimeGregorian(1969-06-01 00:00:00)]</span>
<span class="go"> [cftime.DatetimeGregorian(1965-06-01 00:00:00) cftime.DatetimeGregorian(1969-09-01 00:00:00)]</span>
<span class="go"> [cftime.DatetimeGregorian(1965-09-01 00:00:00) cftime.DatetimeGregorian(1969-12-01 00:00:00)]]</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id41">
<div class="code-block-caption"><span class="caption-text"><em>Calculate the multiannual average of the seasonal means,
restricting the years from 1963 to 1968.</em></span><a class="headerlink" href="#id41" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;T: mean within years T: mean over years&#39;</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">,</span>
<span class="gp">... </span>               <span class="n">within_years</span><span class="o">=</span><span class="n">cf</span><span class="o">.</span><span class="n">seasons</span><span class="p">(),</span> <span class="n">over_years</span><span class="o">=</span><span class="n">cf</span><span class="o">.</span><span class="n">year</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">wi</span><span class="p">(</span><span class="mi">1963</span><span class="p">,</span> <span class="mi">1968</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="go">Field: air_potential_temperature (ncvar%air_potential_temperature)</span>
<span class="go">------------------------------------------------------------------</span>
<span class="go">Data            : air_potential_temperature(time(4), latitude(5), longitude(8)) K</span>
<span class="go">Cell methods    : area: mean time(4): mean within years time(4): mean over years</span>
<span class="go">Dimension coords: time(4) = [1963-01-15 00:00:00, ..., 1963-10-16 12:00:00]</span>
<span class="go">                : latitude(5) = [-75.0, ..., 75.0] degrees_north</span>
<span class="go">                : longitude(8) = [22.5, ..., 337.5] degrees_east</span>
<span class="go">                : air_pressure(1) = [850.0] hPa</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">coordinate</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">datetime_array</span><span class="p">)</span>
<span class="go">[[cftime.DatetimeGregorian(1962-12-01 00:00:00) cftime.DatetimeGregorian(1968-03-01 00:00:00)]</span>
<span class="go"> [cftime.DatetimeGregorian(1963-03-01 00:00:00) cftime.DatetimeGregorian(1968-06-01 00:00:00)]</span>
<span class="go"> [cftime.DatetimeGregorian(1963-06-01 00:00:00) cftime.DatetimeGregorian(1968-09-01 00:00:00)]</span>
<span class="go"> [cftime.DatetimeGregorian(1963-09-01 00:00:00) cftime.DatetimeGregorian(1968-12-01 00:00:00)]]</span>
</pre></div>
</div>
</div>
<p>Similarly for collapses over days, it is assumed by default that the
each portion of the diurnal cycle is collapsed over all days that are
present, But it is possible to restrict the days to be included, or
group them into chunks, with the <em>over_days</em> keyword to
<a class="reference internal" href="method/cf.Field.collapse.html#cf.Field.collapse" title="cf.Field.collapse"><code class="xref py py-obj docutils literal notranslate"><span class="pre">collapse</span></code></a>.</p>
<p>The calculation can be done with multiple collapse calls, which can be
useful if the interim stages are needed independently, but be aware
that the interim field constructs will have non-CF-compliant cell
method constructs.</p>
<div class="literal-block-wrapper docutils container" id="id42">
<div class="code-block-caption"><span class="caption-text"><em>Calculate the multiannual maximum of the seasonal
standard deviations with two separate collapse calls.</em></span><a class="headerlink" href="#id42" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;T: standard_deviation within years&#39;</span><span class="p">,</span>
<span class="gp">... </span>               <span class="n">within_years</span><span class="o">=</span><span class="n">cf</span><span class="o">.</span><span class="n">seasons</span><span class="p">(),</span> <span class="n">weights</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="go">Field: air_potential_temperature (ncvar%air_potential_temperature)</span>
<span class="go">------------------------------------------------------------------</span>
<span class="go">Data            : air_potential_temperature(time(40), latitude(5), longitude(8)) K</span>
<span class="go">Cell methods    : area: mean time(40): standard_deviation within years</span>
<span class="go">Dimension coords: time(40) = [1960-01-15 12:00:00, ..., 1969-10-16 12:00:00]</span>
<span class="go">                : latitude(5) = [-75.0, ..., 75.0] degrees_north</span>
<span class="go">                : longitude(8) = [22.5, ..., 337.5] degrees_east</span>
<span class="go">                : air_pressure(1) = [850.0] hPa</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;T: maximum over years&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">Field: air_potential_temperature (ncvar%air_potential_temperature)</span>
<span class="go">------------------------------------------------------------------</span>
<span class="go">Data            : air_potential_temperature(time(4), latitude(5), longitude(8)) K</span>
<span class="go">Cell methods    : area: mean time(4): standard_deviation within years time(4): maximum over years</span>
<span class="go">Dimension coords: time(4) = [1960-01-15 12:00:00, ..., 1960-10-16 12:00:00]</span>
<span class="go">                : latitude(5) = [-75.0, ..., 75.0] degrees_north</span>
<span class="go">                : longitude(8) = [22.5, ..., 337.5] degrees_east</span>
<span class="go">                : air_pressure(1) = [850.0] hPa</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
</div>
</div>
<div class="section" id="other-statistical-operations">
<h1><strong>Other statistical operations</strong><a class="headerlink" href="#other-statistical-operations" title="Permalink to this headline">¶</a></h1>
<div class="section" id="cumulative-sums">
<span id="id8"></span><h2>Cumulative sums<a class="headerlink" href="#cumulative-sums" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="method/cf.Field.cumsum.html#cf.Field.cumsum" title="cf.Field.cumsum"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cumsum</span></code></a> method of the field construct calculates the
cumulative sum of elements along a given axis. The cell bounds of the
axis are updated to describe the ranges over which the sums apply, and
a new <code class="docutils literal notranslate"><span class="pre">sum</span></code> cell method construct is added to the resulting field
construct.</p>
<div class="literal-block-wrapper docutils container" id="id43">
<div class="code-block-caption"><span class="caption-text"><em>Calculate cumulative sums along the “T” axis, showing
the cell bounds before and after the operation.</em></span><a class="headerlink" href="#id43" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;timeseries.nc&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">Field: air_potential_temperature (ncvar%air_potential_temperature)</span>
<span class="go">------------------------------------------------------------------</span>
<span class="go">Data            : air_potential_temperature(time(120), latitude(5), longitude(8)) K</span>
<span class="go">Cell methods    : area: mean</span>
<span class="go">Dimension coords: time(120) = [1959-12-16 12:00:00, ..., 1969-11-16 00:00:00]</span>
<span class="go">                : latitude(5) = [-75.0, ..., 75.0] degrees_north</span>
<span class="go">                : longitude(8) = [22.5, ..., 337.5] degrees_east</span>
<span class="go">                : air_pressure(1) = [850.0] hPa</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="go">Field: air_potential_temperature (ncvar%air_potential_temperature)</span>
<span class="go">------------------------------------------------------------------</span>
<span class="go">Data            : air_potential_temperature(time(120), latitude(5), longitude(8)) K</span>
<span class="go">Cell methods    : area: mean time(120): sum</span>
<span class="go">Dimension coords: time(120) = [1959-12-16 12:00:00, ..., 1969-11-16 00:00:00]</span>
<span class="go">                : latitude(5) = [-75.0, ..., 75.0] degrees_north</span>
<span class="go">                : longitude(8) = [22.5, ..., 337.5] degrees_east</span>
<span class="go">                : air_pressure(1) = [850.0] hPa</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">coordinate</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dtarray</span><span class="p">)</span>
<span class="go">[[cftime.DatetimeGregorian(1969-11-01 00:00:00)</span>
<span class="go">  cftime.DatetimeGregorian(1969-12-01 00:00:00))]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">coordinate</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dtarray</span><span class="p">)</span>
<span class="go">[[cftime.DatetimeGregorian(1959-11-01 00:00:00)</span>
<span class="go">  cftime.DatetimeGregorian(1969-12-01 00:00:00))]]</span>
</pre></div>
</div>
</div>
<p>The treatment of missing values can be specified, as well as the
positioning of coordinate values in the summed axis of the returned
field construct.</p>
</div>
<div class="section" id="histograms">
<span id="id9"></span><h2>Histograms<a class="headerlink" href="#histograms" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="function/cf.histogram.html#cf.histogram" title="cf.histogram"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cf.histogram</span></code></a> function is used to record the distribution of a
set of variables in the form of an N-dimensional histogram.</p>
<p>Each dimension of the histogram is defined by a field construct
returned by the <a class="reference internal" href="method/cf.Field.digitize.html#cf.Field.digitize" title="cf.Field.digitize"><code class="xref py py-obj docutils literal notranslate"><span class="pre">digitize</span></code></a> method of a field construct. This
“digitized” field construct defines a sequence of bins and provides
indices to the bins that each value of one of the variables belongs.</p>
<div class="literal-block-wrapper docutils container" id="id44">
<div class="code-block-caption"><span class="caption-text"><em>Create a one-dimensional histogram of a field construct
based on 10 equally-sized bins that exactly span the data
range.</em></span><a class="headerlink" href="#id44" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;file.nc&#39;</span><span class="p">)</span>
<span class="go">Field: specific_humidity (ncvar%q)</span>
<span class="go">----------------------------------</span>
<span class="go">Data            : specific_humidity(latitude(5), longitude(8)) 1</span>
<span class="go">Cell methods    : area: mean</span>
<span class="go">Dimension coords: latitude(5) = [-75.0, ..., 75.0] degrees_north</span>
<span class="go">                : longitude(8) = [22.5, ..., 337.5] degrees_east</span>
<span class="go">                : time(1) = [2019-01-01 00:00:00]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[[0.007 0.034 0.003 0.014 0.018 0.037 0.024 0.029]</span>
<span class="go"> [0.023 0.036 0.045 0.062 0.046 0.073 0.006 0.066]</span>
<span class="go"> [0.11  0.131 0.124 0.146 0.087 0.103 0.057 0.011]</span>
<span class="go"> [0.029 0.059 0.039 0.07  0.058 0.072 0.009 0.017]</span>
<span class="go"> [0.006 0.036 0.019 0.035 0.018 0.037 0.034 0.013]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">indices</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">return_bins</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
<span class="go">Field: long_name=Bin index to which each &#39;specific_humidity&#39; value belongs (ncvar%q)</span>
<span class="go">------------------------------------------------------------------------------------</span>
<span class="go">Data            : long_name=Bin index to which each &#39;specific_humidity&#39; value belongs(latitude(5), longitude(8))</span>
<span class="go">Cell methods    : area: mean</span>
<span class="go">Dimension coords: latitude(5) = [-75.0, ..., 75.0] degrees_north</span>
<span class="go">                : longitude(8) = [22.5, ..., 337.5] degrees_eastg</span>
<span class="go">                : time(1) = [2019-01-01 00:00:00]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">indices</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[[0 2 0 0 1 2 1 1]</span>
<span class="go"> [1 2 2 4 3 4 0 4]</span>
<span class="go"> [7 8 8 9 5 6 3 0]</span>
<span class="go"> [1 3 2 4 3 4 0 0]</span>
<span class="go"> [0 2 1 2 1 2 2 0]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">bins</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[[0.003  0.0173]</span>
<span class="go"> [0.0173 0.0316]</span>
<span class="go"> [0.0316 0.0459]</span>
<span class="go"> [0.0459 0.0602]</span>
<span class="go"> [0.0602 0.0745]</span>
<span class="go"> [0.0745 0.0888]</span>
<span class="go"> [0.0888 0.1031]</span>
<span class="go"> [0.1031 0.1174]</span>
<span class="go"> [0.1174 0.1317]</span>
<span class="go"> [0.1317 0.146 ]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
<span class="go">Field: number_of_observations</span>
<span class="go">-----------------------------</span>
<span class="go">Data            : number_of_observations(specific_humidity(10)) 1</span>
<span class="go">Cell methods    : latitude: longitude: point</span>
<span class="go">Dimension coords: specific_humidity(10) = [10.15, ..., 138.85000000000002] 1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[9 7 9 4 5 1 1 1 2 1]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">coordinate</span><span class="p">(</span><span class="s1">&#39;specific_humidity&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[[0.003  0.0173]</span>
<span class="go"> [0.0173 0.0316]</span>
<span class="go"> [0.0316 0.0459]</span>
<span class="go"> [0.0459 0.0602]</span>
<span class="go"> [0.0602 0.0745]</span>
<span class="go"> [0.0745 0.0888]</span>
<span class="go"> [0.0888 0.1031]</span>
<span class="go"> [0.1031 0.1174]</span>
<span class="go"> [0.1174 0.1317]</span>
<span class="go"> [0.1317 0.146 ]]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="binning-operations">
<span id="id10"></span><h2>Binning operations<a class="headerlink" href="#binning-operations" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="method/cf.Field.bin.html#cf.Field.bin" title="cf.Field.bin"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bin</span></code></a> method of the field construct groups its data into
bins, where each group is defined by the elements that correspond to
an <a class="reference internal" href="tutorial.html#histograms"><span class="std std-ref">N-dimensionsal histogram bin of another set of variables</span></a>, and collapses the elements in each group to a single
representative value. The same <a class="reference internal" href="tutorial.html#collapse-methods"><span class="std std-ref">collapse methods</span></a> and <a class="reference internal" href="tutorial.html#collapse-weights"><span class="std std-ref">weighting options</span></a> as
the <a class="reference internal" href="method/cf.Field.collapse.html#cf.Field.collapse" title="cf.Field.collapse"><code class="xref py py-obj docutils literal notranslate"><span class="pre">collapse</span></code></a> method are available.</p>
<p>The result of the binning operation is a field construct whose domain
axis and dimension coordinate constructs describe the sizes of the
N-dimensional bins of the other set of variables.</p>
<div class="literal-block-wrapper docutils container" id="id45">
<div class="code-block-caption"><span class="caption-text"><em>Find the range of values that lie in each of bin 10
equally-sized bins of the data itself.</em></span><a class="headerlink" href="#id45" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;file.nc&#39;</span><span class="p">)</span>
<span class="go">Field: specific_humidity (ncvar%q)</span>
<span class="go">----------------------------------</span>
<span class="go">Data            : specific_humidity(latitude(5), longitude(8)) 0.001 1</span>
<span class="go">Cell methods    : area: mean</span>
<span class="go">Dimension coords: latitude(5) = [-75.0, ..., 75.0] degrees_north</span>
<span class="go">                : longitude(8) = [22.5, ..., 337.5] degrees_east</span>
<span class="go">                : time(1) = [2019-01-01 00:00:00]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[[0.007 0.034 0.003 0.014 0.018 0.037 0.024 0.029]</span>
<span class="go"> [0.023 0.036 0.045 0.062 0.046 0.073 0.006 0.066]</span>
<span class="go"> [0.11  0.131 0.124 0.146 0.087 0.103 0.057 0.011]</span>
<span class="go"> [0.029 0.059 0.039 0.07  0.058 0.072 0.009 0.017]</span>
<span class="go"> [0.006 0.036 0.019 0.035 0.018 0.037 0.034 0.013]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">indices</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">bin</span><span class="p">(</span><span class="s1">&#39;range&#39;</span><span class="p">,</span> <span class="n">digitized</span><span class="o">=</span><span class="n">indices</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="go">Field: specific_humidity</span>
<span class="go">------------------------</span>
<span class="go">Data            : specific_humidity(specific_humidity(5)) 1</span>
<span class="go">Cell methods    : latitude: longitude: range</span>
<span class="go">Dimension coords: specific_humidity(5) = [0.0173, ..., 0.1317] 1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[0.026 0.025 0.025 0.007 0.022]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">coordinate</span><span class="p">(</span><span class="s1">&#39;specific_humidity&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[[0.003  0.0316]</span>
<span class="go"> [0.0316 0.0602]</span>
<span class="go"> [0.0602 0.0888]</span>
<span class="go"> [0.0888 0.1174]</span>
<span class="go"> [0.1174 0.146 ]]</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id46">
<div class="code-block-caption"><span class="caption-text"><em>Find the area-weighted mean of specific humidity values
that correspond to two-dimensional bins defined by
temperature and pressure values.</em></span><a class="headerlink" href="#id46" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;file2.nc&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="go">Field: air_temperature (ncvar%t)</span>
<span class="go">--------------------------------</span>
<span class="go">Data            : air_temperature(latitude(5), longitude(8)) degreesC</span>
<span class="go">Cell methods    : area: mean</span>
<span class="go">Dimension coords: latitude(5) = [-75.0, ..., 75.0] degrees_north</span>
<span class="go">                : longitude(8) = [22.5, ..., 337.5] degrees_east</span>
<span class="go">                : time(1) = [2019-01-01 00:00:00]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="go">Field: air_pressure (ncvar%p)</span>
<span class="go">-----------------------------</span>
<span class="go">Data            : air_pressure(latitude(5), longitude(8)) hPa</span>
<span class="go">Cell methods    : area: mean</span>
<span class="go">Dimension coords: latitude(5) = [-75.0, ..., 75.0] degrees_north</span>
<span class="go">                : longitude(8) = [22.5, ..., 337.5] degrees_east</span>
<span class="go">                : time(1) = [2019-01-01 00:00:00]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t_indices</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p_indices</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">bin</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">digitized</span><span class="o">=</span><span class="p">[</span><span class="n">t_indices</span><span class="p">,</span> <span class="n">p_indices</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="s1">&#39;area&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="go">Field: specific_humidity</span>
<span class="go">------------------------</span>
<span class="go">Data            : specific_humidity(air_pressure(6), air_temperature(4)) 1</span>
<span class="go">Cell methods    : latitude: longitude: mean</span>
<span class="go">Dimension coords: air_pressure(6) = [966.6225003326126, ..., 1033.6456080043665] hPa</span>
<span class="go">                : air_temperature(4) = [-12.735821567738295, ..., 9.9702610462581] degreesC</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[[     --       --       --  0.011  ]</span>
<span class="go"> [0.131    0.0145   0.0345   0.05052]</span>
<span class="go"> [0.05742  0.01727  0.06392  0.0105 ]</span>
<span class="go"> [     --  0.04516  0.05272  0.10194]</span>
<span class="go"> [0.124    0.024    0.059    0.006  ]</span>
<span class="go"> [     --  0.08971       --       --]]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="percentiles">
<span id="id11"></span><h2>Percentiles<a class="headerlink" href="#percentiles" title="Permalink to this headline">¶</a></h2>
<p>Percentiles of the data can be computed along any subset of the axes
with the <a class="reference internal" href="method/cf.Field.percentile.html#cf.Field.percentile" title="cf.Field.percentile"><code class="xref py py-obj docutils literal notranslate"><span class="pre">percentile</span></code></a> method fof the field construct.</p>
<div class="literal-block-wrapper docutils container" id="id47">
<div class="code-block-caption"><span class="caption-text"><em>Find the 20th, 40th, 50th, 60th and 80th percentiles.</em></span><a class="headerlink" href="#id47" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;file.nc&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
<span class="go">Field: specific_humidity</span>
<span class="go">------------------------</span>
<span class="go">Data            : specific_humidity(latitude(5), longitude(8)) 1</span>
<span class="go">Cell methods    : area: mean</span>
<span class="go">Dimension coords: time(1) = [2019-01-01 00:00:00]</span>
<span class="go">                : latitude(5) = [-75.0, ..., 75.0] degrees_north</span>
<span class="go">                : longitude(8) = [22.5, ..., 337.5] degrees_east</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[[0.007 0.034 0.003 0.014 0.018 0.037 0.024 0.029]</span>
<span class="go"> [0.023 0.036 0.045 0.062 0.046 0.073 0.006 0.066]</span>
<span class="go"> [0.11  0.131 0.124 0.146 0.087 0.103 0.057 0.011]</span>
<span class="go"> [0.029 0.059 0.039 0.07  0.058 0.072 0.009 0.017]</span>
<span class="go"> [0.006 0.036 0.019 0.035 0.018 0.037 0.034 0.013]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">percentile</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">80</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="go">Field: specific_humidity</span>
<span class="go">------------------------</span>
<span class="go">Data            : specific_humidity(long_name=Percentile ranks for latitude, longitude dimensions(5), latitude(1), longitude(1)) 1</span>
<span class="go">Dimension coords: time(1) = [2019-01-01 00:00:00]</span>
<span class="go">                : latitude(1) = [0.0] degrees_north</span>
<span class="go">                : longitude(1) = [180.0] degrees_east</span>
<span class="go">                : long_name=Percentile ranks for latitude, longitude dimensions(5) = [20, ..., 80]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[[[0.0164]]</span>
<span class="go"> [[0.032 ]]</span>
<span class="go"> [[0.036 ]]</span>
<span class="go"> [[0.0414]]</span>
<span class="go"> [[0.0704]]]</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id48">
<div class="code-block-caption"><span class="caption-text"><em>Find the standard deviation of the values above the 80th
percentile.</em></span><a class="headerlink" href="#id48" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p80</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="mi">80</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">p80</span><span class="p">)</span>
<span class="go">Field: specific_humidity</span>
<span class="go">------------------------</span>
<span class="go">Data            : specific_humidity(latitude(1), longitude(1)) 1</span>
<span class="go">Dimension coords: time(1) = [2019-01-01 00:00:00]</span>
<span class="go">                : latitude(1) = [0.0] degrees_north</span>
<span class="go">                : longitude(1) = [180.0] degrees_east</span>
<span class="go">                : long_name=Percentile ranks for latitude, longitude dimensions(1) = [80]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">q</span><span class="o">&lt;=</span><span class="n">p80</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">masked</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[[  --    --    --    --    --    -- -- --]</span>
<span class="go"> [  --    --    --    --    -- 0.073 -- --]</span>
<span class="go"> [0.11 0.131 0.124 0.146 0.087 0.103 -- --]</span>
<span class="go"> [  --    --    --    --    -- 0.072 -- --]</span>
<span class="go"> [  --    --    --    --    --    -- -- --]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;standard_deviation&#39;</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="s1">&#39;area&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
<span class="go">&lt;CF Data(1, 1): [[0.024609938742357642]] 1&gt;</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id49">
<div class="code-block-caption"><span class="caption-text"><em>Find the mean of the values above the 45th percentile
along the X axis.</em></span><a class="headerlink" href="#id49" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p45</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">p45</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[[0.0189 ]</span>
<span class="go"> [0.04515]</span>
<span class="go"> [0.10405]</span>
<span class="go"> [0.04185]</span>
<span class="go"> [0.02125]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">q</span><span class="o">&lt;=</span><span class="n">p45</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">masked</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[[  -- 0.034    --    --    -- 0.037 0.024 0.029]</span>
<span class="go"> [  --    --    -- 0.062 0.046 0.073    -- 0.066]</span>
<span class="go"> [0.11 0.131 0.124 0.146    --    --    --    --]</span>
<span class="go"> [  -- 0.059    -- 0.07  0.058 0.072    --    --]</span>
<span class="go"> [  -- 0.036    -- 0.035   --  0.037 0.034    --]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;X: mean&#39;</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[[0.031  ]</span>
<span class="go"> [0.06175]</span>
<span class="go"> [0.12775]</span>
<span class="go"> [0.06475]</span>
<span class="go"> [0.0355 ]]</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id50">
<div class="code-block-caption"><span class="caption-text"><em>Find the histogram bin boundaries associated with given
percentiles, and digitize the data based on these bins.</em></span><a class="headerlink" href="#id50" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bins</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">percentile</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="n">squeeze</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">bins</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[0.003  0.0088 0.036  0.1037 0.146 ]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">i</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">closed_ends</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[[0 1 0 1 1 2 1 1]</span>
<span class="go"> [1 2 2 2 2 2 0 2]</span>
<span class="go"> [3 3 3 3 2 2 2 1]</span>
<span class="go"> [1 2 2 2 2 2 1 1]</span>
<span class="go"> [0 2 1 1 1 2 1 1]]</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
</div>
</div>
<div class="section" id="regridding">
<span id="id12"></span><h1><strong>Regridding</strong><a class="headerlink" href="#regridding" title="Permalink to this headline">¶</a></h1>
<p>Regridding, also called remapping or interpolation, is the process of
changing the domain of a field construct whilst preserving the
qualities of the original data.</p>
<p>The field construct has two regridding methods: <a class="reference internal" href="method/cf.Field.regrids.html#cf.Field.regrids" title="cf.Field.regrids"><code class="xref py py-obj docutils literal notranslate"><span class="pre">regrids</span></code></a> for
regridding data between domains with spherical coordinate systems; and
<a class="reference internal" href="method/cf.Field.regridc.html#cf.Field.regridc" title="cf.Field.regridc"><code class="xref py py-obj docutils literal notranslate"><span class="pre">regridc</span></code></a> for regridding data between domains with Cartesian
coordinate systems. The interpolation is carried by out using the
<a class="reference external" href="https://www.earthsystemcog.org/projects/esmpy">ESMF</a> package, a
Python interface to the Earth System Modeling Framework regridding
utility.</p>
<p>As with <a class="reference internal" href="tutorial.html#statistical-collapses"><span class="std std-ref">statistical collapses</span></a>,
regridding may be applied over a subset of the domain axes, and the
domain axis constructs and coordinate constructs for the non-regridded
dimensions remain the same.</p>
<p><a class="reference internal" href="tutorial.html#domain-ancillaries"><span class="std std-ref">Domain ancillary constructs</span></a> whose data
spans the regridding dimensions are also regridded, but <a class="reference internal" href="tutorial.html#field-ancillaries"><span class="std std-ref">field
ancillary constructs</span></a> whose data spans the
regridding dimensions are removed from the regridded field construct.</p>
<p>The following regridding methods are available (in this table,
“source” and “destination” refer to the domain of the field construct
being regridded, and the domain that it is being regridded to,
respectively):</p>
<table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="66%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Method</th>
<th class="head">Notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Linear</td>
<td>One dimensional linear interpolation (only
available to <a class="reference internal" href="#id14">Cartesian regridding</a>).</td>
</tr>
<tr class="row-odd"><td>Bilinear</td>
<td>Two dimensional variant of linear
interpolation.</td>
</tr>
<tr class="row-even"><td>Trilinear</td>
<td>Three dimensional variant of linear
interpolation (only available to
<a class="reference internal" href="#cartesian-regridding">Cartesian-regridding</a>).</td>
</tr>
<tr class="row-odd"><td>First order conservative</td>
<td>Preserve the integral of the data across
the interpolation from source to
destination. It uses the proportion of the
area of the overlapping source and
destination cells to determine appropriate
weights. In particular, the weight of a
source cell is the ratio of the area of
intersection of the source and destination
cells to the area of the whole destination
cell.</td>
</tr>
<tr class="row-even"><td>Patch</td>
<td>A second degree polynomial regridding method,
which uses a least squares algorithm to
calculate the polynomial. This method gives
better derivatives in the resulting
destination data than the bilinear method.</td>
</tr>
<tr class="row-odd"><td>Nearest neighbour</td>
<td>Nearest neighbour interpolation that is useful
for extrapolation of categorical data. Either
each destination point is mapped to the
closest source; or each source point is mapped
to the closest destination point. In the
latter case, a given destination point may
receive input from multiple source points, but
no source point will map to more than one
destination point.</td>
</tr>
</tbody>
</table>
<div class="section" id="spherical-regridding">
<span id="id13"></span><h2>Spherical regridding<a class="headerlink" href="#spherical-regridding" title="Permalink to this headline">¶</a></h2>
<p>Regridding from and to spherical coordinate systems using the
<a class="reference internal" href="method/cf.Field.regrids.html#cf.Field.regrids" title="cf.Field.regrids"><code class="xref py py-obj docutils literal notranslate"><span class="pre">regrids</span></code></a> method is only available for the ‘X’ and ‘Y’ axes
simultaneously. All other axes are unchanged. The calculation of the
regridding weights is based on areas and distances on the surface of
the sphere, rather in <a class="reference internal" href="tutorial.html#cartesian-regridding"><span class="std std-ref">Euclidian space</span></a>.</p>
<p>The following combinations of spherical source and destination domain
coordinate systems are available to the <a class="reference internal" href="method/cf.Field.regrids.html#cf.Field.regrids" title="cf.Field.regrids"><code class="xref py py-obj docutils literal notranslate"><span class="pre">regrids</span></code></a> method:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Spherical source domain</th>
<th class="head">Spherical destination domain</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference external" href="http://cfconventions.org/Data/cf-conventions/cf-conventions-1.7/cf-conventions.html#_latitude_longitude">Latitude-longitude</a></td>
<td><a class="reference external" href="http://cfconventions.org/Data/cf-conventions/cf-conventions-1.7/cf-conventions.html#_latitude_longitude">Latitude-longitude</a></td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="http://cfconventions.org/Data/cf-conventions/cf-conventions-1.7/cf-conventions.html#_latitude_longitude">Latitude-longitude</a></td>
<td><a class="reference external" href="http://cfconventions.org/Data/cf-conventions/cf-conventions-1.7/cf-conventions.html#_rotated_pole">Rotated latitude-longitude</a></td>
</tr>
<tr class="row-even"><td><a class="reference external" href="http://cfconventions.org/Data/cf-conventions/cf-conventions-1.7/cf-conventions.html#_latitude_longitude">Latitude-longitude</a></td>
<td><a class="reference external" href="http://cfconventions.org/Data/cf-conventions/cf-conventions-1.7/cf-conventions.html#appendix-grid-mappings">Plane projection</a></td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="http://cfconventions.org/Data/cf-conventions/cf-conventions-1.7/cf-conventions.html#_latitude_longitude">Latitude-longitude</a></td>
<td><a class="reference external" href="https://doi.org/10.1007%2FBF00211684">Tripolar</a></td>
</tr>
<tr class="row-even"><td><a class="reference external" href="http://cfconventions.org/Data/cf-conventions/cf-conventions-1.7/cf-conventions.html#_rotated_pole">Rotated latitude-longitude</a></td>
<td><a class="reference external" href="http://cfconventions.org/Data/cf-conventions/cf-conventions-1.7/cf-conventions.html#_latitude_longitude">Latitude-longitude</a></td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="http://cfconventions.org/Data/cf-conventions/cf-conventions-1.7/cf-conventions.html#_rotated_pole">Rotated latitude-longitude</a></td>
<td><a class="reference external" href="http://cfconventions.org/Data/cf-conventions/cf-conventions-1.7/cf-conventions.html#_rotated_pole">Rotated latitude-longitude</a></td>
</tr>
<tr class="row-even"><td><a class="reference external" href="http://cfconventions.org/Data/cf-conventions/cf-conventions-1.7/cf-conventions.html#_rotated_pole">Rotated latitude-longitude</a></td>
<td><a class="reference external" href="http://cfconventions.org/Data/cf-conventions/cf-conventions-1.7/cf-conventions.html#appendix-grid-mappings">Plane projection</a></td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="http://cfconventions.org/Data/cf-conventions/cf-conventions-1.7/cf-conventions.html#_rotated_pole">Rotated latitude-longitude</a></td>
<td><a class="reference external" href="https://doi.org/10.1007%2FBF00211684">Tripolar</a></td>
</tr>
<tr class="row-even"><td><a class="reference external" href="http://cfconventions.org/Data/cf-conventions/cf-conventions-1.7/cf-conventions.html#appendix-grid-mappings">Plane projection</a></td>
<td><a class="reference external" href="http://cfconventions.org/Data/cf-conventions/cf-conventions-1.7/cf-conventions.html#_latitude_longitude">Latitude-longitude</a></td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="http://cfconventions.org/Data/cf-conventions/cf-conventions-1.7/cf-conventions.html#appendix-grid-mappings">Plane projection</a></td>
<td><a class="reference external" href="http://cfconventions.org/Data/cf-conventions/cf-conventions-1.7/cf-conventions.html#_rotated_pole">Rotated latitude-longitude</a></td>
</tr>
<tr class="row-even"><td><a class="reference external" href="http://cfconventions.org/Data/cf-conventions/cf-conventions-1.7/cf-conventions.html#appendix-grid-mappings">Plane projection</a></td>
<td><a class="reference external" href="http://cfconventions.org/Data/cf-conventions/cf-conventions-1.7/cf-conventions.html#appendix-grid-mappings">Plane projection</a></td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="http://cfconventions.org/Data/cf-conventions/cf-conventions-1.7/cf-conventions.html#appendix-grid-mappings">Plane projection</a></td>
<td><a class="reference external" href="https://doi.org/10.1007%2FBF00211684">Tripolar</a></td>
</tr>
<tr class="row-even"><td><a class="reference external" href="https://doi.org/10.1007%2FBF00211684">Tripolar</a></td>
<td><a class="reference external" href="http://cfconventions.org/Data/cf-conventions/cf-conventions-1.7/cf-conventions.html#_latitude_longitude">Latitude-longitude</a></td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="https://doi.org/10.1007%2FBF00211684">Tripolar</a></td>
<td><a class="reference external" href="http://cfconventions.org/Data/cf-conventions/cf-conventions-1.7/cf-conventions.html#_rotated_pole">Rotated latitude-longitude</a></td>
</tr>
<tr class="row-even"><td><a class="reference external" href="https://doi.org/10.1007%2FBF00211684">Tripolar</a></td>
<td><a class="reference external" href="http://cfconventions.org/Data/cf-conventions/cf-conventions-1.7/cf-conventions.html#appendix-grid-mappings">Plane projection</a></td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="https://doi.org/10.1007%2FBF00211684">Tripolar</a></td>
<td><a class="reference external" href="https://doi.org/10.1007%2FBF00211684">Tripolar</a></td>
</tr>
</tbody>
</table>
<p>The most convenient usage is for the destination domain to be exist
in another field construct. In this case, the regridding command is
very simple:</p>
<div class="literal-block-wrapper docutils container" id="id51">
<div class="code-block-caption"><span class="caption-text"><em>TODO. The files air_temperature.nc and
precipitation_flux.nc are found in the zip file of
sample files.</em></span><a class="headerlink" href="#id51" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;air_temperature.nc&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;precipitation_flux.nc&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">Field: air_temperature (ncvar%tas)</span>
<span class="go">----------------------------------</span>
<span class="go">Data            : air_temperature(time(2), latitude(73), longitude(96)) K</span>
<span class="go">Cell methods    : time(2): mean</span>
<span class="go">Dimension coords: time(2) = [1860-01-16 00:00:00, 1860-02-16 00:00:00] 360_day</span>
<span class="go">                : latitude(73) = [-90.0, ..., 90.0] degrees_north</span>
<span class="go">                : longitude(96) = [0.0, ..., 356.25] degrees_east</span>
<span class="go">                : height(1) = [2.0] m</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="go">Field: precipitation_flux (ncvar%tas)</span>
<span class="go">-------------------------------------</span>
<span class="go">Data            : precipitation_flux(time(1), latitude(64), longitude(128)) kg m-2 day-1</span>
<span class="go">Cell methods    : time(1): mean (interval: 1.0 month)</span>
<span class="go">Dimension coords: time(1) = [0450-11-16 00:00:00] noleap</span>
<span class="go">                : latitude(64) = [-87.86380004882812, ..., 87.86380004882812] degrees_north</span>
<span class="go">                : longitude(128) = [0.0, ..., 357.1875] degrees_east</span>
<span class="go">                : height(1) = [2.0] m</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">regrids</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="s1">&#39;conservative&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">Field: air_temperature (ncvar%tas)</span>
<span class="go">----------------------------------</span>
<span class="go">Data            : air_temperature(time(2), latitude(64), longitude(128)) K</span>
<span class="go">Cell methods    : time(2): mean</span>
<span class="go">Dimension coords: time(2) = [1860-01-16 00:00:00, 1860-02-16 00:00:00] 360_day</span>
<span class="go">                : latitude(64) = [-87.86380004882812, ..., 87.86380004882812] degrees_north</span>
<span class="go">                : longitude(128) = [0.0, ..., 357.1875] degrees_east</span>
<span class="go">                : height(1) = [2.0] m</span>
</pre></div>
</div>
</div>
<p>It is generally not necessary to specify which are the ‘X’ and ‘Y’
axes in the domains of both the source and destination field
constructs, since they will be automatically identified by their
metadata. However, in cases when this is not possible (such as for
tripolar domains) the <em>src_axes</em> or <em>dst_axes</em> keywords of the
<a class="reference internal" href="method/cf.Field.regrids.html#cf.Field.regrids" title="cf.Field.regrids"><code class="xref py py-obj docutils literal notranslate"><span class="pre">regrids</span></code></a> method can be used.</p>
<p>It may be that the required destination domain does not exist in a
field construct. In this case, the latitude and longitudes of the
destination domain may be defined solely by dimension or auxiliary
coordinate constructs.</p>
<div class="literal-block-wrapper docutils container" id="id52">
<div class="code-block-caption"><span class="caption-text"><em>TODO</em></span><a class="headerlink" href="#id52" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lat</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">DimensionCoordinate</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mf">92.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">),</span> <span class="s1">&#39;degrees_north&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lon</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">DimensionCoordinate</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">),</span> <span class="s1">&#39;degrees_east&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">regrids</span><span class="p">({</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="n">lat</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="n">lon</span><span class="p">},</span> <span class="s1">&#39;bilinear&#39;</span><span class="p">)</span>
<span class="go">Field: air_temperature (ncvar%tas)</span>
<span class="go">----------------------------------</span>
<span class="go">Data            : air_temperature(time(2), latitude(73), longitude(72)) K</span>
<span class="go">Cell methods    : time(2): mean</span>
<span class="go">Dimension coords: time(2) = [1860-01-16 00:00:00, 1860-02-16 00:00:00] 360_day</span>
<span class="go">                : latitude(73) = [-90.0, ..., 90.0] degrees_north</span>
<span class="go">                : longitude(72) = [0.0, ..., 355.0] degrees_east</span>
<span class="go">                : height(1) = [2.0] m</span>
</pre></div>
</div>
</div>
<p>A destination domain defined by two dimensional (curvilinear) latitude
and longitude auxiliary coordinate constructs can also be specified in
a similar manner.</p>
<p>An axis is <a class="reference internal" href="tutorial.html#cyclic-domain-axes"><span class="std std-ref">cyclic</span></a> if cells at both of its
ends are actually geographically adjacent. In spherical regridding,
only the ‘X’ axis has the potential for being cyclic. For example, a
longitude cell spanning 359 to 360 degrees east is proximate to the
cell spanning 0 to 1 degrees east.</p>
<p>When a cyclic dimension can not be automatically detected, such as
when its dimension coordinate construct does not have bounds,
cyclicity may be set with the <em>src_cyclic</em> or <em>dst_cyclic</em> keywords of
the <a class="reference internal" href="method/cf.Field.regrids.html#cf.Field.regrids" title="cf.Field.regrids"><code class="xref py py-obj docutils literal notranslate"><span class="pre">regrids</span></code></a> method.</p>
<p>To find out whether a dimension is cyclic use the <a class="reference internal" href="method/cf.Field.iscyclic.html#cf.Field.iscyclic" title="cf.Field.iscyclic"><code class="xref py py-obj docutils literal notranslate"><span class="pre">iscyclic</span></code></a>
method of the field construct, or to manually set its cyclicity use
the <code class="xref py py-obj docutils literal notranslate"><span class="pre">cyclic</span></code> method. If the destination domain has been defined by a
dictionary of dimension coordinate constructs, then cyclicity can be
registered by setting a period of cyclicity with the
<a class="reference internal" href="method/cf.DimensionCoordinate.period.html#cf.DimensionCoordinate.period" title="cf.DimensionCoordinate.period"><code class="xref py py-obj docutils literal notranslate"><span class="pre">period</span></code></a> method of the dimension coordinate
construct.</p>
</div>
<div class="section" id="cartesian-regridding">
<span id="id14"></span><h2>Cartesian regridding<a class="headerlink" href="#cartesian-regridding" title="Permalink to this headline">¶</a></h2>
<p>Cartesian regridding with the <a class="reference internal" href="method/cf.Field.regridc.html#cf.Field.regridc" title="cf.Field.regridc"><code class="xref py py-obj docutils literal notranslate"><span class="pre">regridc</span></code></a> method is very
similar to <a class="reference internal" href="tutorial.html#spherical-regridding"><span class="std std-ref">spherical regridding</span></a>, except
regridding dimensions are not restricted to the horizontal plane, the
source and destination domains are assumed to be <a class="reference external" href="https://en.wikipedia.org/wiki/Euclidean_space">Euclidian spaces</a> for the purpose of
calculating regridding weights, and all dimensions are assumed to be
non-cyclic by default.</p>
<p>Cartesian regridding can be done in up to three dimensions. It is
often used for regridding along the time dimension. A plane projection
coordinate system can be regridded with Cartesian regridding, which
will produce similar results to using using spherical regridding.</p>
<div class="literal-block-wrapper docutils container" id="id53">
<div class="code-block-caption"><span class="caption-text"><em>TODO</em></span><a class="headerlink" href="#id53" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">time</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">DimensionCoordinate</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">time</span><span class="o">.</span><span class="n">standard_name</span><span class="o">=</span><span class="s1">&#39;time&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">time</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="gp">... </span>                      <span class="n">units</span><span class="o">=</span><span class="s1">&#39;days since 1860-01-01&#39;</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="s1">&#39;360_day&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">time</span>
<span class="go">&lt;CF DimensionCoordinate: time(60) days since 1860-01-01 360_day&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">regridc</span><span class="p">({</span><span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="n">time</span><span class="p">},</span> <span class="n">axes</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">)</span>
<span class="go">Field: air_temperature (ncvar%tas)</span>
<span class="go">----------------------------------</span>
<span class="go">Data            : air_temperature(time(60), latitude(73), longitude(96)) K</span>
<span class="go">Cell methods    : time(60): mean</span>
<span class="go">Dimension coords: time(60) = [1860-01-01 12:00:00, ..., 1860-02-30 12:00:00] 360_day</span>
<span class="go">                : latitude(73) = [-90.0, ..., 90.0] degrees_north</span>
<span class="go">                : longitude(96) = [0.0, ..., 356.25] degrees_east</span>
<span class="go">                : height(1) = [2.0] m</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id54">
<div class="code-block-caption"><span class="caption-text"><em>TODO</em></span><a class="headerlink" href="#id54" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">regridc</span><span class="p">({</span><span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="n">time</span><span class="p">},</span> <span class="n">axes</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;conservative&#39;</span><span class="p">)</span>  <span class="c1"># Raises Exception</span>
<span class="go">ValueError: Destination coordinates must have contiguous, non-overlapping bounds for conservative regridding.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bounds</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">create_bounds</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">time</span><span class="o">.</span><span class="n">set_bounds</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">regridc</span><span class="p">({</span><span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="n">time</span><span class="p">},</span> <span class="n">axes</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;conservative&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">Field: air_temperature (ncvar%tas)</span>
<span class="go">----------------------------------</span>
<span class="go">Data            : air_temperature(time(60), latitude(73), longitude(96)) K</span>
<span class="go">Cell methods    : time(60): mean</span>
<span class="go">Dimension coords: time(60) = [1860-01-01 12:00:00, ..., 1860-02-30 12:00:00] 360_day</span>
<span class="go">                : latitude(73) = [-90.0, ..., 90.0] degrees_north</span>
<span class="go">                : longitude(96) = [0.0, ..., 356.25] degrees_east</span>
<span class="go">                : height(1) = [2.0] m</span>
</pre></div>
</div>
</div>
<p>Cartesian regridding to the dimension of another field construct is
also possible, similarly to spherical regridding.</p>
</div>
<div class="section" id="regridding-masked-data">
<span id="id15"></span><h2>Regridding masked data<a class="headerlink" href="#regridding-masked-data" title="Permalink to this headline">¶</a></h2>
<p>The data mask of the source field construct is taken into account,
such that the regridded data will be masked in regions where the
source data is masked. By default the mask of the destination field
construct is not used, but can be taken into account by setting
<em>use_dst_mask</em> keyword to the <a class="reference internal" href="method/cf.Field.regrids.html#cf.Field.regrids" title="cf.Field.regrids"><code class="xref py py-obj docutils literal notranslate"><span class="pre">regrids</span></code></a> or <a class="reference internal" href="method/cf.Field.regridc.html#cf.Field.regridc" title="cf.Field.regridc"><code class="xref py py-obj docutils literal notranslate"><span class="pre">regridc</span></code></a>
methods. For example, this is useful when part of the destination
domain is not being used (such as the land portion of an ocean grid).</p>
<p>For conservative regridding, masking is done on cells. Masking a
destination cell means that the cell won’t participate in the
regridding. For all other regridding methods, masking is done on
points. For these methods, masking a destination point means that the
point will not participate in the regridding.</p>
</div>
<div class="section" id="vertical-regridding">
<span id="id16"></span><h2>Vertical regridding<a class="headerlink" href="#vertical-regridding" title="Permalink to this headline">¶</a></h2>
<p>The only option for regridding along a vertical axis is to use
Cartesian regridding. However, care must be taken to ensure that the
vertical axis is transformed so that it’s coordinate values are vary
linearly. For example, to regrid data on one set of vertical pressure
coordinates to another set, the pressure coordinates may first be
transformed into the logarithm of pressure, and then changed back to
pressure coordinates after the regridding operation.</p>
<div class="literal-block-wrapper docutils container" id="id55">
<div class="code-block-caption"><span class="caption-text"><em>Regrid a field construct from one set of pressure levels
to another.</em></span><a class="headerlink" href="#id55" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">v</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;vertical.nc&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="go">Field: eastward_wind (ncvar%ua)</span>
<span class="go">-------------------------------</span>
<span class="go">Data            : eastward_wind(time(3), air_pressure(5), grid_latitude(11), grid_longitude(10)) m s-1</span>
<span class="go">Cell methods    : time(3): mean</span>
<span class="go">Dimension coords: time(3) = [1979-05-01 12:00:00, 1979-05-02 12:00:00, 1979-05-03 12:00:00] gregorian</span>
<span class="go">                : air_pressure(5) = [850.0, ..., 50.0] hPa</span>
<span class="go">                : grid_latitude(11) = [23.32, ..., 18.92] degrees</span>
<span class="go">                : grid_longitude(10) = [-20.54, ..., -16.58] degrees</span>
<span class="go">Auxiliary coords: latitude(grid_latitude(11), grid_longitude(10)) = [[67.12, ..., 66.07]] degrees_north</span>
<span class="go">                : longitude(grid_latitude(11), grid_longitude(10)) = [[-45.98, ..., -31.73]] degrees_east</span>
<span class="go">Coord references: grid_mapping_name:rotated_latitude_longitude</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">z_p</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">z_p</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[850. 700. 500. 250.  50.]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">z_ln_p</span> <span class="o">=</span> <span class="n">z_p</span><span class="o">.</span><span class="n">log</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">z_ln_p</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[6.74523635 6.55108034 6.2146081  5.52146092 3.91202301]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">replace_construct</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="n">z_ln_p</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_z_p</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">DimensionCoordinate</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">([</span><span class="mi">800</span><span class="p">,</span> <span class="mi">705</span><span class="p">,</span> <span class="mi">632</span><span class="p">,</span> <span class="mi">510</span><span class="p">,</span> <span class="mf">320.</span><span class="p">],</span> <span class="s1">&#39;hPa&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_z_ln_p</span> <span class="o">=</span> <span class="n">new_z_p</span><span class="o">.</span><span class="n">log</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">regridc</span><span class="p">({</span><span class="s1">&#39;Z&#39;</span><span class="p">:</span> <span class="n">new_z_ln_p</span><span class="p">},</span> <span class="n">axes</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_v</span><span class="o">.</span><span class="n">replace_construct</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="n">new_z_p</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">new_v</span><span class="p">)</span>
<span class="go">Field: eastward_wind (ncvar%ua)</span>
<span class="go">-------------------------------</span>
<span class="go">Data            : eastward_wind(time(3), Z(5), grid_latitude(11), grid_longitude(10)) m s-1</span>
<span class="go">Cell methods    : time(3): mean</span>
<span class="go">Dimension coords: time(3) = [1979-05-01 12:00:00, 1979-05-02 12:00:00, 1979-05-03 12:00:00] gregorian</span>
<span class="go">                : Z(5) = [800.0, ..., 320.0] hPa</span>
<span class="go">                : grid_latitude(11) = [23.32, ..., 18.92] degrees</span>
<span class="go">                : grid_longitude(10) = [-20.54, ..., -16.58] degrees</span>
<span class="go">Auxiliary coords: latitude(grid_latitude(11), grid_longitude(10)) = [[67.12, ..., 66.07]] degrees_north</span>
<span class="go">                : longitude(grid_latitude(11), grid_longitude(10)) = [[-45.98, ..., -31.73]] degrees_east</span>
<span class="go">Coord references: grid_mapping_name:rotated_latitude_longitude</span>
</pre></div>
</div>
</div>
<p>Note that the <a class="reference internal" href="method/cf.Field.replace_construct.html#cf.Field.replace_construct" title="cf.Field.replace_construct"><code class="xref py py-obj docutils literal notranslate"><span class="pre">replace_construct</span></code></a> method of the field construct
is used to easily replace the vertical dimension coordinate construct,
without having to manually match up the corresponding domain axis
construct and construct key.</p>
<hr class="docutils" />
</div>
</div>
<div class="section" id="mathematical-operations">
<span id="id17"></span><h1><strong>Mathematical operations</strong><a class="headerlink" href="#mathematical-operations" title="Permalink to this headline">¶</a></h1>
<div class="section" id="arithmetical-operations">
<span id="id18"></span><h2>Arithmetical operations<a class="headerlink" href="#arithmetical-operations" title="Permalink to this headline">¶</a></h2>
<p>A field construct may be arithmetically combined with another field
construct, or any other object that is broadcastable to its data. See
the <a class="reference internal" href="classes/cf.Field.html#field-binary-arithmetic"><span class="std std-ref">comprehensive list of available binary operations</span></a>.</p>
<p>When combining with another field construct, its data is actually
combined, but only after being transformed so that it is broadcastable
to the first field construct’s data. This is done by using the
metadata constructs of the two field constructs to create a mapping of
physically compatible dimensions between the fields, and then
<a class="reference internal" href="tutorial.html#manipulating-dimensions"><span class="std std-ref">manipulating the dimensions</span></a> of the
other field construct’s data to ensure that they are broadcastable.</p>
<p>In any case, a field construct may appear as the left or right
operand, and augmented assignments are possible.</p>
<p>Automatic units conversions are also carried out between operands
during operations, and if one operand has no units then the units of
the other are assumed.</p>
<div class="literal-block-wrapper docutils container" id="id56">
<div class="code-block-caption"><span class="caption-text"><em>TODO</em></span><a class="headerlink" href="#id56" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="o">&gt;&gt;&gt;</span> <span class="n">q</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;file.nc&#39;</span><span class="p">)</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="n">t</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">stats</span><span class="p">()</span>
 <span class="p">{</span><span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">CF</span> <span class="n">Data</span><span class="p">():</span> <span class="mf">260.0</span> <span class="n">K</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">CF</span> <span class="n">Data</span><span class="p">():</span> <span class="mf">269.9244444444445</span> <span class="n">K</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">CF</span> <span class="n">Data</span><span class="p">():</span> <span class="mf">280.0</span> <span class="n">K</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">CF</span> <span class="n">Data</span><span class="p">():</span> <span class="mf">20.0</span> <span class="n">K</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="s1">&#39;mid_range&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">CF</span> <span class="n">Data</span><span class="p">():</span> <span class="mf">270.0</span> <span class="n">K</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="s1">&#39;standard_deviation&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">CF</span> <span class="n">Data</span><span class="p">():</span> <span class="mf">5.942452002538104</span> <span class="n">K</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="s1">&#39;sample_size&#39;</span><span class="p">:</span> <span class="mi">90</span><span class="p">}</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="n">t</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="n">x</span>
 <span class="o">&lt;</span><span class="n">CF</span> <span class="n">Field</span><span class="p">:</span> <span class="n">air_temperature</span><span class="p">(</span><span class="n">atmosphere_hybrid_height_coordinate</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">grid_latitude</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">grid_longitude</span><span class="p">(</span><span class="mi">9</span><span class="p">))</span> <span class="n">K</span><span class="o">&gt;</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
 <span class="o">&lt;</span><span class="n">CF</span> <span class="n">Data</span><span class="p">():</span> <span class="mf">520.0</span> <span class="n">K</span><span class="o">&gt;</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
 <span class="o">&lt;</span><span class="n">CF</span> <span class="n">Data</span><span class="p">():</span> <span class="mf">258.0</span> <span class="n">K</span><span class="o">&gt;</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
 <span class="o">&lt;</span><span class="n">CF</span> <span class="n">Data</span><span class="p">():</span> <span class="mf">262.0</span> <span class="n">K</span><span class="o">&gt;</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">)))</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
 <span class="o">&lt;</span><span class="n">CF</span> <span class="n">Data</span><span class="p">():</span> <span class="mf">0.0</span> <span class="n">K</span><span class="o">&gt;</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">29</span><span class="p">),</span> <span class="s1">&#39;0.1 K&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
 <span class="o">&lt;</span><span class="n">CF</span> <span class="n">Data</span><span class="p">():</span> <span class="mf">262.6</span> <span class="n">K</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id57">
<div class="code-block-caption"><span class="caption-text"><em>TODO</em></span><a class="headerlink" href="#id57" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> &gt;&gt;&gt; u = t.copy()
 &gt;&gt;&gt; u.transpose(inplace=True)
 &gt;&gt;&gt; u.Units -= 273.15
 &gt;&gt;&gt; u[0]
 &lt;CF Field: air_temperature(grid_longitude(1), grid_latitude(10), atmosphere_hybrid_height_coordinate(1)) K @ 273.15&gt;
 &gt;&gt;&gt; t + u[0]
 &lt;CF Field: air_temperature(atmosphere_hybrid_height_coordinate(1), grid_latitude(10), grid_longitude(9)) K&gt;
</pre></div>
</div>
</div>
<p>If the physical nature of the result differs from both operands, then
the “standard_name” and “long_name” properties are removed. This is
the case if the units of the result differ from bother operands, or if
they have different standard names.</p>
<div class="literal-block-wrapper docutils container" id="id58">
<div class="code-block-caption"><span class="caption-text"><em>TODO</em></span><a class="headerlink" href="#id58" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="o">&gt;&gt;&gt;</span> <span class="n">t</span><span class="o">.</span><span class="n">identities</span><span class="p">()</span>
 <span class="p">[</span><span class="s1">&#39;air_temperature&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Conventions=CF-1.7&#39;</span><span class="p">,</span>
  <span class="s1">&#39;project=research&#39;</span><span class="p">,</span>
  <span class="s1">&#39;units=K&#39;</span><span class="p">,</span>
  <span class="s1">&#39;standard_name=air_temperature&#39;</span><span class="p">,</span>
  <span class="s1">&#39;ncvar%ta&#39;</span><span class="p">]</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="n">u</span> <span class="o">=</span> <span class="n">t</span> <span class="o">*</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;ms-1&#39;</span><span class="p">)</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="n">u</span><span class="o">.</span><span class="n">identities</span><span class="p">()</span>
 <span class="p">[</span><span class="s1">&#39;Conventions=CF-1.7&#39;</span><span class="p">,</span>
  <span class="s1">&#39;project=research&#39;</span><span class="p">,</span>
  <span class="s1">&#39;units=1000 s-1.K&#39;</span><span class="p">,</span>
  <span class="s1">&#39;ncvar%ta&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Care must be taken when combining a field construct with a
<a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/index.html#module-numpy" title="(in NumPy v1.17)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span></code></a> array or a <a class="reference internal" href="classes/cf.Data.html#cf.Data" title="cf.Data"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Data</span></code></a> instance, due to the ways in which
both of these objects allow themselves to be combined with
other types:</p>
<ul class="simple">
<li>If the field construct is on the left hand side (LHS) of
the operation then, as expected, a field construct is
returned whose data is the combination of the original
field construct’s data and the <a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/index.html#module-numpy" title="(in NumPy v1.17)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span></code></a> array or <a class="reference internal" href="classes/cf.Data.html#cf.Data" title="cf.Data"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Data</span></code></a>
instance on the right hand side (RHS).</li>
<li>If, however, the field construct is on the RHS then a
<a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/index.html#module-numpy" title="(in NumPy v1.17)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span></code></a> array or <a class="reference internal" href="classes/cf.Data.html#cf.Data" title="cf.Data"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Data</span></code></a> innstance (which ever type is on
the LHS) is returned, containing the same data as in the
first case.</li>
</ul>
<div class="literal-block-wrapper last docutils container" id="id59">
<div class="code-block-caption"><span class="caption-text"><em>A field construct will not be returned if the
left hand operand is a numpy array or a ‘Data’
instance.</em></span><a class="headerlink" href="#id59" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;fil.nc&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">t</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span>
<span class="go">cf.field.Field</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">t</span><span class="p">)</span>
<span class="go">numpy.ndarray</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">t</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span>
<span class="go">cf.field.Field</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
<span class="go">numpy.ndarray</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
<span class="go">cf.field.Field</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
<span class="go">cf.data.data.Data</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="unary-operations">
<span id="id19"></span><h2>Unary operations<a class="headerlink" href="#unary-operations" title="Permalink to this headline">¶</a></h2>
<p>Python unary operators also work on the field construct’s data,
returning a new field construct with modified data values. See the
<a class="reference internal" href="classes/cf.Field.html#field-unary-arithmetic"><span class="std std-ref">comprehensive list of available unary operations</span></a>.</p>
<div class="literal-block-wrapper docutils container" id="id60">
<div class="code-block-caption"><span class="caption-text"><em>TODO</em></span><a class="headerlink" href="#id60" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="o">&gt;&gt;&gt;</span> <span class="n">q</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;file.nc&#39;</span><span class="p">)</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
 <span class="p">[[</span><span class="mf">0.007</span> <span class="mf">0.034</span> <span class="mf">0.003</span> <span class="mf">0.014</span> <span class="mf">0.018</span> <span class="mf">0.037</span> <span class="mf">0.024</span> <span class="mf">0.029</span><span class="p">]</span>
  <span class="p">[</span><span class="mf">0.023</span> <span class="mf">0.036</span> <span class="mf">0.045</span> <span class="mf">0.062</span> <span class="mf">0.046</span> <span class="mf">0.073</span> <span class="mf">0.006</span> <span class="mf">0.066</span><span class="p">]</span>
  <span class="p">[</span><span class="mf">0.11</span>  <span class="mf">0.131</span> <span class="mf">0.124</span> <span class="mf">0.146</span> <span class="mf">0.087</span> <span class="mf">0.103</span> <span class="mf">0.057</span> <span class="mf">0.011</span><span class="p">]</span>
  <span class="p">[</span><span class="mf">0.029</span> <span class="mf">0.059</span> <span class="mf">0.039</span> <span class="mf">0.07</span>  <span class="mf">0.058</span> <span class="mf">0.072</span> <span class="mf">0.009</span> <span class="mf">0.017</span><span class="p">]</span>
  <span class="p">[</span><span class="mf">0.006</span> <span class="mf">0.036</span> <span class="mf">0.019</span> <span class="mf">0.035</span> <span class="mf">0.018</span> <span class="mf">0.037</span> <span class="mf">0.034</span> <span class="mf">0.013</span><span class="p">]]</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
 <span class="p">[[</span><span class="o">-</span><span class="mf">0.007</span> <span class="o">-</span><span class="mf">0.034</span> <span class="o">-</span><span class="mf">0.003</span> <span class="o">-</span><span class="mf">0.014</span> <span class="o">-</span><span class="mf">0.018</span> <span class="o">-</span><span class="mf">0.037</span> <span class="o">-</span><span class="mf">0.024</span> <span class="o">-</span><span class="mf">0.029</span><span class="p">]</span>
  <span class="p">[</span><span class="o">-</span><span class="mf">0.023</span> <span class="o">-</span><span class="mf">0.036</span> <span class="o">-</span><span class="mf">0.045</span> <span class="o">-</span><span class="mf">0.062</span> <span class="o">-</span><span class="mf">0.046</span> <span class="o">-</span><span class="mf">0.073</span> <span class="o">-</span><span class="mf">0.006</span> <span class="o">-</span><span class="mf">0.066</span><span class="p">]</span>
  <span class="p">[</span><span class="o">-</span><span class="mf">0.11</span>  <span class="o">-</span><span class="mf">0.131</span> <span class="o">-</span><span class="mf">0.124</span> <span class="o">-</span><span class="mf">0.146</span> <span class="o">-</span><span class="mf">0.087</span> <span class="o">-</span><span class="mf">0.103</span> <span class="o">-</span><span class="mf">0.057</span> <span class="o">-</span><span class="mf">0.011</span><span class="p">]</span>
  <span class="p">[</span><span class="o">-</span><span class="mf">0.029</span> <span class="o">-</span><span class="mf">0.059</span> <span class="o">-</span><span class="mf">0.039</span> <span class="o">-</span><span class="mf">0.07</span>  <span class="o">-</span><span class="mf">0.058</span> <span class="o">-</span><span class="mf">0.072</span> <span class="o">-</span><span class="mf">0.009</span> <span class="o">-</span><span class="mf">0.017</span><span class="p">]</span>
  <span class="p">[</span><span class="o">-</span><span class="mf">0.006</span> <span class="o">-</span><span class="mf">0.036</span> <span class="o">-</span><span class="mf">0.019</span> <span class="o">-</span><span class="mf">0.035</span> <span class="o">-</span><span class="mf">0.018</span> <span class="o">-</span><span class="mf">0.037</span> <span class="o">-</span><span class="mf">0.034</span> <span class="o">-</span><span class="mf">0.013</span><span class="p">]]</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
 <span class="p">[[</span><span class="mf">0.007</span> <span class="mf">0.034</span> <span class="mf">0.003</span> <span class="mf">0.014</span> <span class="mf">0.018</span> <span class="mf">0.037</span> <span class="mf">0.024</span> <span class="mf">0.029</span><span class="p">]</span>
  <span class="p">[</span><span class="mf">0.023</span> <span class="mf">0.036</span> <span class="mf">0.045</span> <span class="mf">0.062</span> <span class="mf">0.046</span> <span class="mf">0.073</span> <span class="mf">0.006</span> <span class="mf">0.066</span><span class="p">]</span>
  <span class="p">[</span><span class="mf">0.11</span>  <span class="mf">0.131</span> <span class="mf">0.124</span> <span class="mf">0.146</span> <span class="mf">0.087</span> <span class="mf">0.103</span> <span class="mf">0.057</span> <span class="mf">0.011</span><span class="p">]</span>
  <span class="p">[</span><span class="mf">0.029</span> <span class="mf">0.059</span> <span class="mf">0.039</span> <span class="mf">0.07</span>  <span class="mf">0.058</span> <span class="mf">0.072</span> <span class="mf">0.009</span> <span class="mf">0.017</span><span class="p">]</span>
  <span class="p">[</span><span class="mf">0.006</span> <span class="mf">0.036</span> <span class="mf">0.019</span> <span class="mf">0.035</span> <span class="mf">0.018</span> <span class="mf">0.037</span> <span class="mf">0.034</span> <span class="mf">0.013</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="relational-operations">
<span id="id20"></span><h2>Relational operations<a class="headerlink" href="#relational-operations" title="Permalink to this headline">¶</a></h2>
<p>A field construct may compared with another field construct, or any
other object that is broadcastable to its data. See the
<a class="reference internal" href="classes/cf.Field.html#field-comparison"><span class="std std-ref">comprehensive list of available relational operations</span></a>. The result is a field construct with a boolean
data values.</p>
<p>When comparing with another field construct, its data is actually
combined, but only after being transformed so that it is broadcastable
to the first field construct’s data. This is done by using the
metadata constructs of the two field constructs to create a mapping of
physically compatible dimensions between the fields, and then
<a class="reference internal" href="tutorial.html#manipulating-dimensions"><span class="std std-ref">manipulating the dimensions</span></a> of the
other field construct’s data to ensure that they are broadcastable.</p>
<p>In any case, a field construct may appear as the left or right
operand.</p>
<p>Automatic units conversions are also carried out between operands
during operations, and if one operand has no units then the units of
the other are assumed.</p>
<div class="literal-block-wrapper docutils container" id="id61">
<div class="code-block-caption"><span class="caption-text"><em>TODO</em></span><a class="headerlink" href="#id61" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="o">&gt;&gt;&gt;</span> <span class="n">q</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;file.nc&#39;</span><span class="p">)</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
 <span class="p">[[</span><span class="mf">0.007</span> <span class="mf">0.034</span> <span class="mf">0.003</span> <span class="mf">0.014</span> <span class="mf">0.018</span> <span class="mf">0.037</span> <span class="mf">0.024</span> <span class="mf">0.029</span><span class="p">]</span>
  <span class="p">[</span><span class="mf">0.023</span> <span class="mf">0.036</span> <span class="mf">0.045</span> <span class="mf">0.062</span> <span class="mf">0.046</span> <span class="mf">0.073</span> <span class="mf">0.006</span> <span class="mf">0.066</span><span class="p">]</span>
  <span class="p">[</span><span class="mf">0.11</span>  <span class="mf">0.131</span> <span class="mf">0.124</span> <span class="mf">0.146</span> <span class="mf">0.087</span> <span class="mf">0.103</span> <span class="mf">0.057</span> <span class="mf">0.011</span><span class="p">]</span>
  <span class="p">[</span><span class="mf">0.029</span> <span class="mf">0.059</span> <span class="mf">0.039</span> <span class="mf">0.07</span>  <span class="mf">0.058</span> <span class="mf">0.072</span> <span class="mf">0.009</span> <span class="mf">0.017</span><span class="p">]</span>
  <span class="p">[</span><span class="mf">0.006</span> <span class="mf">0.036</span> <span class="mf">0.019</span> <span class="mf">0.035</span> <span class="mf">0.018</span> <span class="mf">0.037</span> <span class="mf">0.034</span> <span class="mf">0.013</span><span class="p">]]</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">((</span><span class="n">q</span> <span class="o">==</span> <span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
 <span class="p">[[</span> <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span><span class="p">]</span>
  <span class="p">[</span> <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span><span class="p">]</span>
  <span class="p">[</span> <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span><span class="p">]</span>
  <span class="p">[</span> <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span><span class="p">]</span>
  <span class="p">[</span> <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span><span class="p">]]</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">((</span><span class="n">q</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
 <span class="p">[[</span> <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span><span class="p">]</span>
  <span class="p">[</span> <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span> <span class="bp">False</span>  <span class="bp">True</span> <span class="bp">False</span>  <span class="bp">True</span> <span class="bp">False</span><span class="p">]</span>
  <span class="p">[</span><span class="bp">False</span> <span class="bp">False</span> <span class="bp">False</span> <span class="bp">False</span> <span class="bp">False</span> <span class="bp">False</span> <span class="bp">False</span>  <span class="bp">True</span><span class="p">]</span>
  <span class="p">[</span> <span class="bp">True</span> <span class="bp">False</span>  <span class="bp">True</span> <span class="bp">False</span> <span class="bp">False</span> <span class="bp">False</span>  <span class="bp">True</span>  <span class="bp">True</span><span class="p">]</span>
  <span class="p">[</span> <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span><span class="p">]]</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">((</span><span class="n">q</span> <span class="o">&gt;=</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
 <span class="p">[[</span> <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span><span class="p">]</span>
  <span class="p">[</span> <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span> <span class="bp">False</span>  <span class="bp">True</span><span class="p">]</span>
  <span class="p">[</span> <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span> <span class="bp">False</span><span class="p">]</span>
  <span class="p">[</span> <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span> <span class="bp">False</span> <span class="bp">False</span><span class="p">]</span>
  <span class="p">[</span><span class="bp">False</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span>  <span class="bp">True</span> <span class="bp">False</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<p>The “standard_name” and “long_name” properties are removed from the
result, which also has no units.</p>
<div class="literal-block-wrapper docutils container" id="id62">
<div class="code-block-caption"><span class="caption-text"><em>TODO</em></span><a class="headerlink" href="#id62" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="o">&gt;&gt;&gt;</span> <span class="n">q</span><span class="o">.</span><span class="n">identities</span><span class="p">()</span>
 <span class="p">[</span><span class="s1">&#39;specific_humidity&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Conventions=CF-1.7&#39;</span><span class="p">,</span>
  <span class="s1">&#39;project=research&#39;</span><span class="p">,</span>
  <span class="s1">&#39;units=1&#39;</span><span class="p">,</span>
  <span class="s1">&#39;standard_name=specific_humidity&#39;</span><span class="p">,</span>
  <span class="s1">&#39;ncvar%q&#39;</span><span class="p">]</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="n">r</span> <span class="o">=</span> <span class="n">q</span> <span class="o">&gt;</span> <span class="n">q</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="o">.</span><span class="n">identities</span><span class="p">()</span>
 <span class="p">[</span><span class="s1">&#39;Conventions=CF-1.7&#39;</span><span class="p">,</span>
  <span class="s1">&#39;project=research&#39;</span><span class="p">,</span>
  <span class="s1">&#39;units=&#39;</span><span class="p">,</span>
  <span class="s1">&#39;ncvar%q&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="arithmetical-and-relational-operations-with-insufficient-metadata">
<h2>Arithmetical and relational operations with insufficient metadata<a class="headerlink" href="#arithmetical-and-relational-operations-with-insufficient-metadata" title="Permalink to this headline">¶</a></h2>
<p>If both operands of an <a class="reference internal" href="tutorial.html#arithmetical-operations"><span class="std std-ref">arithmetical</span></a>
or <a class="reference internal" href="tutorial.html#relational-operations"><span class="std std-ref">relational</span></a> operation are field
constructs with insufficient metadata to create a mapping of physically
compatible dimensions, there are various techniques that allow the
operation the operation procede.</p>
<ul class="simple">
<li><strong>Option 1:</strong> The operation may applied to the field constructs’
data instead. See below for more details.</li>
<li><strong>Option 2:</strong> If the mapping is not possible due to the absence of
<code class="xref py py-obj docutils literal notranslate"><span class="pre">standard_name</span></code> properties (or <code class="xref py py-obj docutils literal notranslate"><span class="pre">id</span></code> attributes) on metadata
constructs that are known to correspond, then setting “relaxed
identities” with the <a class="reference internal" href="function/cf.RELAXED_IDENTITIES.html#cf.RELAXED_IDENTITIES" title="cf.RELAXED_IDENTITIES"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cf.RELAXED_IDENTITIES</span></code></a> function may help.</li>
<li><strong>Option 3:</strong> Add more metadata to the field and metadata constructs.</li>
</ul>
<p>For <strong>Option 1</strong> the resulting data may then be inserted into a copy
of one of the field constructs, either with the <a class="reference internal" href="method/cf.Field.set_data.html#cf.Field.set_data" title="cf.Field.set_data"><code class="xref py py-obj docutils literal notranslate"><span class="pre">set_data</span></code></a>
method of the field construct, or with <a class="reference internal" href="tutorial.html#assignment-by-index"><span class="std std-ref">indexed assignment</span></a>. The former technique is faster and more memory
efficient, but the latter technique allows broadcasting.</p>
<p>Note that it is assumed, and not checked, that the dimensions of both
<a class="reference internal" href="classes/cf.Data.html#cf.Data" title="cf.Data"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Data</span></code></a> instance operands are already in the correct order for
physically meaningful broadcasting to occur.</p>
<div class="literal-block-wrapper docutils container" id="id63">
<div class="code-block-caption"><span class="caption-text"><em>Operate on the data and use ‘set_data’ to put the
resulting data into the new field construct.</em></span><a class="headerlink" href="#id63" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="go">&lt;CF Data(): 260.0 K&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_data</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">data</span> <span class="o">+</span> <span class="n">t</span><span class="o">.</span><span class="n">data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">new_data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span>
<span class="go">&lt;CF Field: air_temperature(atmosphere_hybrid_height_coordinate(1), grid_latitude(10), grid_longitude(9)) K&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="go">&lt;CF Data(): 520.0 K&gt;</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id64">
<div class="code-block-caption"><span class="caption-text"><em>Update the data with indexed assignment</em></span><a class="headerlink" href="#id64" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="o">&gt;&gt;&gt;</span> <span class="n">u</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_data</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="n">u</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
 <span class="o">&lt;</span><span class="n">CF</span> <span class="n">Data</span><span class="p">():</span> <span class="mf">520.0</span> <span class="n">K</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<p>For augmented assignments, the field construct data may be changed
in-place.</p>
<div class="literal-block-wrapper docutils container" id="id65">
<div class="code-block-caption"><span class="caption-text"><em>An example of augmented assignment involving the data of
two field constructs.</em></span><a class="headerlink" href="#id65" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="o">&gt;&gt;&gt;</span> <span class="n">t</span><span class="o">.</span><span class="n">data</span> <span class="o">-=</span> <span class="n">t</span><span class="o">.</span><span class="n">data</span>
 <span class="o">&gt;&gt;&gt;</span> <span class="n">t</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
 <span class="o">&lt;</span><span class="n">CF</span> <span class="n">Data</span><span class="p">():</span> <span class="mf">0.0</span> <span class="n">K</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="trigonometrical-functions">
<h2>Trigonometrical functions<a class="headerlink" href="#trigonometrical-functions" title="Permalink to this headline">¶</a></h2>
<p>The field construct and metadata constructs have <a class="reference internal" href="method/cf.Field.cos.html#cf.Field.cos" title="cf.Field.cos"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cos</span></code></a>,
<a class="reference internal" href="method/cf.Field.sin.html#cf.Field.sin" title="cf.Field.sin"><code class="xref py py-obj docutils literal notranslate"><span class="pre">sin</span></code></a> and <a class="reference internal" href="method/cf.Field.tan.html#cf.Field.tan" title="cf.Field.tan"><code class="xref py py-obj docutils literal notranslate"><span class="pre">tan</span></code></a> methods for applying trigonometrical
functions element-wise to the data, preserving the metadata but
changing the construct’s units.</p>
<div class="literal-block-wrapper docutils container" id="id66">
<div class="code-block-caption"><span class="caption-text"><em>Find the sine of each latitude coordinate value.</em></span><a class="headerlink" href="#id66" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;file.nc&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lat</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">dimension_coordinate</span><span class="p">(</span><span class="s1">&#39;latitude&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lat</span><span class="o">.</span><span class="n">data</span>
<span class="go">&lt;CF Data(5): [-75.0, ..., 75.0] degrees_north&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sin_lat</span> <span class="o">=</span> <span class="n">lat</span><span class="o">.</span><span class="n">sin</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sin_lat</span><span class="o">.</span><span class="n">data</span>
<span class="go">&lt;CF Data(5): [-0.9659258262890683, ..., 0.9659258262890683] 1&gt;</span>
</pre></div>
</div>
</div>
<p>The “standard_name” and “long_name” properties are removed from the
result.</p>
</div>
<div class="section" id="exponential-and-logarithmic-functions">
<h2>Exponential and logarithmic functions<a class="headerlink" href="#exponential-and-logarithmic-functions" title="Permalink to this headline">¶</a></h2>
<p>The field construct and metadata constructs have <a class="reference internal" href="method/cf.Field.exp.html#cf.Field.exp" title="cf.Field.exp"><code class="xref py py-obj docutils literal notranslate"><span class="pre">exp</span></code></a> and
<a class="reference internal" href="method/cf.Field.log.html#cf.Field.log" title="cf.Field.log"><code class="xref py py-obj docutils literal notranslate"><span class="pre">log</span></code></a> methods for applying exponential and logarithmic
functions respectively element-wise to the data, preserving the
metadata but changing the construct’s units where required.</p>
<div class="literal-block-wrapper docutils container" id="id67">
<div class="code-block-caption"><span class="caption-text"><em>Find the logarithms and exponentials of field constructs.</em></span><a class="headerlink" href="#id67" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span>
<span class="go">&lt;CF Field: specific_humidity(latitude(5), longitude(8)) 1&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">log</span><span class="p">()</span>
<span class="go">&lt;CF Field: specific_humidity(latitude(5), longitude(8)) ln(re 1)&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">exp</span><span class="p">()</span>
<span class="go">&lt;CF Field: specific_humidity(latitude(5), longitude(8)) 1&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span>
<span class="go">&lt;CF Field: air_temperature(atmosphere_hybrid_height_coordinate(1), grid_latitude(10), grid_longitude(9)) K&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="go">&lt;CF Field: air_temperature(atmosphere_hybrid_height_coordinate(1), grid_latitude(10), grid_longitude(9)) lg(re 1 K)&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">exp</span><span class="p">()</span>                                                <span class="c1"># Raises Exception</span>
<span class="go">ValueError: Can&#39;t take exponential of dimensional quantities: &lt;Units: K&gt;</span>
</pre></div>
</div>
</div>
<p>The “standard_name” and “long_name” properties are removed from the
result.</p>
</div>
<div class="section" id="rounding-and-truncation">
<h2>Rounding and truncation<a class="headerlink" href="#rounding-and-truncation" title="Permalink to this headline">¶</a></h2>
<p>The field construct and metadata constructs the following methods to
round and truncate their data:</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Method</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference internal" href="method/cf.Field.ceil.html#cf.Field.ceil" title="cf.Field.ceil"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ceil</span></code></a></td>
<td>The ceiling of the data, element-wise.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="method/cf.Field.clip.html#cf.Field.clip" title="cf.Field.clip"><code class="xref py py-obj docutils literal notranslate"><span class="pre">clip</span></code></a></td>
<td>Limit the values in the data.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="method/cf.Field.floor.html#cf.Field.floor" title="cf.Field.floor"><code class="xref py py-obj docutils literal notranslate"><span class="pre">floor</span></code></a></td>
<td>Floor the data array, element-wise.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="method/cf.Field.rint.html#cf.Field.rint" title="cf.Field.rint"><code class="xref py py-obj docutils literal notranslate"><span class="pre">rint</span></code></a></td>
<td>Round the data to the nearest integer, element-wise.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="method/cf.Field.round.html#cf.Field.round" title="cf.Field.round"><code class="xref py py-obj docutils literal notranslate"><span class="pre">round</span></code></a></td>
<td>Round the data to the given number of decimals.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="method/cf.Field.trunc.html#cf.Field.trunc" title="cf.Field.trunc"><code class="xref py py-obj docutils literal notranslate"><span class="pre">trunc</span></code></a></td>
<td>Truncate the data, element-wise.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="convolution-filters">
<h2>Convolution filters<a class="headerlink" href="#convolution-filters" title="Permalink to this headline">¶</a></h2>
<p>A <a class="reference external" href="https://en.wikipedia.org/wiki/Convolution">convolution</a> of the
field construct data with a filter along a single domain axis can be
calculated, which also updates the bounds of a relevant dimension
coordinate construct to account for the width of the
filter. Convolution filters are carried with the
<a class="reference internal" href="method/cf.Field.convolution_filter.html#cf.Field.convolution_filter" title="cf.Field.convolution_filter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">convolution_filter</span></code></a> method of the field construct.</p>
<div class="literal-block-wrapper docutils container" id="id68">
<div class="code-block-caption"><span class="caption-text"><em>Calculate a 5-point weighted mean of the ‘X’ axis. Since
the the ‘X’ axis is cyclic, the convolution wraps by
default.</em></span><a class="headerlink" href="#id68" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
<span class="go">Field: specific_humidity (ncvar%q)</span>
<span class="go">----------------------------------</span>
<span class="go">Data            : specific_humidity(latitude(5), longitude(8)) 1</span>
<span class="go">Cell methods    : area: mean</span>
<span class="go">Dimension coords: latitude(5) = [-75.0, ..., 75.0] degrees_north</span>
<span class="go">                : longitude(8) = [22.5, ..., 337.5] degrees_east</span>
<span class="go">                : time(1) = [2019-01-01 00:00:00]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">iscyclic</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">convolution_filter</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="go">Field: specific_humidity (ncvar%q)</span>
<span class="go">----------------------------------</span>
<span class="go">Data            : specific_humidity(latitude(5), longitude(8)) 1</span>
<span class="go">Cell methods    : area: mean</span>
<span class="go">Dimension coords: latitude(5) = [-75.0, ..., 75.0] degrees_north</span>
<span class="go">                : longitude(8) = [22.5, ..., 337.5] degrees_east</span>
<span class="go">                : time(1) = [2019-01-01 00:00:00]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">dimension_coordinate</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[[  0.  45.]</span>
<span class="go"> [ 45.  90.]</span>
<span class="go"> [ 90. 135.]</span>
<span class="go"> [135. 180.]</span>
<span class="go"> [180. 225.]</span>
<span class="go"> [225. 270.]</span>
<span class="go"> [270. 315.]</span>
<span class="go"> [315. 360.]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">dimension_coordinate</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[[-90. 135.]</span>
<span class="go"> [-45. 180.]</span>
<span class="go"> [  0. 225.]</span>
<span class="go"> [ 45. 270.]</span>
<span class="go"> [ 90. 315.]</span>
<span class="go"> [135. 360.]</span>
<span class="go"> [180. 405.]</span>
<span class="go"> [225. 450.]]</span>
</pre></div>
</div>
</div>
<p>The <a class="reference internal" href="method/cf.Field.convolution_filter.html#cf.Field.convolution_filter" title="cf.Field.convolution_filter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">convolution_filter</span></code></a> method of the field construct also has
options to</p>
<ul class="simple">
<li>Specify how the input array is extended when the filter overlaps a
border, and</li>
<li>Control the placement position of the filter window.</li>
</ul>
<p>Note that the <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/signal.windows.html#module-scipy.signal.windows" title="(in SciPy v1.3.2)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.signal.windows</span></code></a> package has suite of window
functions for creating weights for filtering:</p>
<div class="literal-block-wrapper docutils container" id="id69">
<div class="code-block-caption"><span class="caption-text"><em>Calculate a 3-point exponential filter of the ‘Y’
axis. Since the ‘Y’ axis is not cyclic, the convolution
by default inserts missing data at points for which the
filter window extends beyond the array.</em></span><a class="headerlink" href="#id69" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">windows</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">exponential_weights</span> <span class="o">=</span> <span class="n">windows</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">exponential_weights</span><span class="p">)</span>
<span class="go">[0.36787944 1.         0.36787944]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">convolution_filter</span><span class="p">(</span><span class="n">exponential_weights</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[[--      --      --      --      --      --      --      --     ]</span>
<span class="go"> [0.06604 0.0967  0.09172 0.12086 0.08463 0.1245  0.0358  0.08072]</span>
<span class="go"> [0.12913 0.16595 0.1549  0.19456 0.12526 0.15634 0.06252 0.04153]</span>
<span class="go"> [0.07167 0.12044 0.09161 0.13659 0.09663 0.1235  0.04248 0.02583]</span>
<span class="go"> [--      --      --      --      --      --      --      --     ]]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="derivatives">
<h2>Derivatives<a class="headerlink" href="#derivatives" title="Permalink to this headline">¶</a></h2>
<p>The derivative along a dimension of the field construct’s data can be
calculated as a centred finite difference with the <a class="reference internal" href="method/cf.Field.derivative.html#cf.Field.derivative" title="cf.Field.derivative"><code class="xref py py-obj docutils literal notranslate"><span class="pre">derivative</span></code></a>
method. If the axis is <a class="reference internal" href="tutorial.html#cyclic-domain-axes"><span class="std std-ref">cyclic</span></a> then the
derivative wraps around by default, otherwise it may be forced to wrap
around; a one-sided difference is calculated at the edges; or missing
data is inserted.</p>
<div class="literal-block-wrapper docutils container" id="id70">
<div class="code-block-caption"><span class="caption-text"><em>TODO</em></span><a class="headerlink" href="#id70" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">derivative</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">derivative</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">one_sided_at_boundary</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="relative-vorticity">
<h2>Relative vorticity<a class="headerlink" href="#relative-vorticity" title="Permalink to this headline">¶</a></h2>
<p>The relative vorticity of the wind may be calculated on a global or
limited area domain, and in Cartesian or spherical polar coordinate
systems.</p>
<p>The relative vorticity of wind defined on a Cartesian domain (such as
a <a class="reference external" href="http://cfconventions.org/Data/cf-conventions/cf-conventions-1.7/cf-conventions.html#appendix-grid-mappings">plane projection</a>) is defined as</p>
<div class="math notranslate nohighlight">
\[\zeta _{cartesian} = \frac{\delta v}{\delta x} -
\frac{\delta u}{\delta y}\]</div>
<p>where <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> are points on along the ‘X’ and ‘Y’
Cartesian dimensions respectively; and <span class="math notranslate nohighlight">\(u\)</span> and <span class="math notranslate nohighlight">\(v\)</span> denote
the ‘X’ and ‘Y’ components of the horizontal winds.</p>
<p>If the wind field field is defined on a spherical latitude-longitude
domain then a correction factor is included:</p>
<div class="math notranslate nohighlight">
\[\zeta _{spherical} = \frac{\delta v}{\delta x} -
\frac{\delta u}{\delta y} + \frac{u}{a}tan(\phi)\]</div>
<p>where <span class="math notranslate nohighlight">\(u\)</span> and <span class="math notranslate nohighlight">\(v\)</span> denote the longitudinal and latitudinal
components of the horizontal wind field; <span class="math notranslate nohighlight">\(a\)</span> is the radius of
the Earth; and <span class="math notranslate nohighlight">\(\phi\)</span> is the latitude at each point.</p>
<p>The <a class="reference internal" href="function/cf.relative_vorticity.html#cf.relative_vorticity" title="cf.relative_vorticity"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cf.relative_vorticity</span></code></a> function creates a relative vorticity
field construct from field constructs containing the wind components
using finite differences to approximate the derivatives. Dimensions
other than ‘X’ and ‘Y’ remain unchanged by the operation.</p>
<div class="literal-block-wrapper docutils container" id="id71">
<div class="code-block-caption"><span class="caption-text"><em>TODO</em></span><a class="headerlink" href="#id71" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;wind_components.nc&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">zeta</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">relative_vorticity</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">zeta</span><span class="p">)</span>
<span class="go">Field: atmosphere_relative_vorticity (ncvar%va)</span>
<span class="go">-----------------------------------------------</span>
<span class="go">Data            : atmosphere_relative_vorticity(time(1), atmosphere_hybrid_height_coordinate(1), latitude(9), longitude(8)) s-1</span>
<span class="go">Dimension coords: time(1) = [1978-09-01 06:00:00] 360_day</span>
<span class="go">                : atmosphere_hybrid_height_coordinate(1) = [9.9982] m</span>
<span class="go">                : latitude(9) = [-90, ..., 70] degrees_north</span>
<span class="go">                : longitude(8) = [0, ..., 315] degrees_east</span>
<span class="go">Coord references: standard_name:atmosphere_hybrid_height_coordinate</span>
<span class="go">Domain ancils   : atmosphere_hybrid_height_coordinate(atmosphere_hybrid_height_coordinate(1)) = [9.9982] m</span>
<span class="go">                : long_name=vertical coordinate formula term: b(k)(atmosphere_hybrid_height_coordinate(1)) = [0.9989]</span>
<span class="go">                : surface_altitude(latitude(9), longitude(8)) = [[2816.25, ..., 2325.98]] m</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">zeta</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span>
<span class="go">[[[[--        --        --        --        --        --        --        --       ]</span>
<span class="go">   [-2.04e-06  1.58e-06  5.19e-06  4.74e-06 -4.76e-06 -2.27e-06  9.55e-06 -3.64e-06]</span>
<span class="go">   [-8.4e-07  -4.37e-06 -3.55e-06 -2.31e-06 -3.6e-07  -8.58e-06 -2.45e-06  6.5e-07 ]</span>
<span class="go">   [ 4.08e-06  4.55e-06  2.75e-06  4.15e-06  5.16e-06  4.17e-06  4.67e-06 -7e-07   ]</span>
<span class="go">   [-1.4e-07  -3.5e-07  -1.27e-06 -1.29e-06  2.01e-06  4.4e-07  -2.5e-06   2.05e-06]</span>
<span class="go">   [-7.3e-07  -1.59e-06 -1.77e-06 -3.13e-06 -7.9e-07  -5.1e-07  -2.79e-06  1.12e-06]</span>
<span class="go">   [-3.7e-07   7.1e-07   1.52e-06  6.5e-07  -2.75e-06 -4.3e-07   1.62e-06 -6.6e-07 ]</span>
<span class="go">   [ 9.5e-07  -8e-07     6.6e-07   7.2e-07  -2.13e-06 -4.5e-07  -7.5e-07  -1.11e-06]</span>
<span class="go">   [--        --        --        --        --        --        --        --       ]]]]</span>
</pre></div>
</div>
</div>
<p>For axes that are not <a class="reference internal" href="tutorial.html#cyclic-domain-axes"><span class="std std-ref">cyclic</span></a>, missing data
is inserted at the edges by default; otherwise it may be forced to
wrap around, or a one-sided difference is calculated at the edges. If
the longitudinal axis is <a class="reference internal" href="tutorial.html#cyclic-domain-axes"><span class="std std-ref">cyclic</span></a> then the
derivative wraps around by default.</p>
<hr class="docutils" />
</div>
</div>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2019, David Hassell.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.11</a>
      
      |
      <a href="_sources/field_analysis.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>