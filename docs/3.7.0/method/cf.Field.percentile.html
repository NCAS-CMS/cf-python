
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>cf.Field.percentile &#8212; Documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/customise-alabaster.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/toggleprompt.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="cf.Field.unique" href="cf.Field.unique.html" />
    <link rel="prev" title="cf.Field.histogram" href="cf.Field.histogram.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">



<h1 class="logo"><a href="../index.html">cf 3.7.0</a></h1>



<p class="blurb">A CF-compliant earth science data analysis library</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=NCAS-CMS&repo=cf-python&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>






<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html"><strong>Introduction</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../cf_data_model.html"><strong>CF data model</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html"><strong>Installation</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html"><strong>Contributing</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html"><strong>Tutorial</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../analysis.html"><strong>Analysis</strong></a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../api_reference.html"><strong>API reference</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../aggregation_rules.html"><strong>Aggregation rules</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../performance.html"><strong>Performance</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases.html"><strong>Releases</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../Changelog.html"><strong>Change log</strong></a></li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../api_reference.html"><strong>API reference</strong></a><ul>
  <li><a href="../class.html"><strong>cf classes</strong></a><ul>
  <li><a href="../class/cf.Field.html">cf.Field</a><ul>
      <li>Previous: <a href="cf.Field.histogram.html" title="previous chapter">cf.Field.histogram</a></li>
      <li>Next: <a href="cf.Field.unique.html" title="next chapter">cf.Field.unique</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="cf-field-percentile">
<h1>cf.Field.percentile<a class="headerlink" href="#cf-field-percentile" title="Permalink to this headline">¶</a></h1>
<dl class="method">
<dt id="cf.Field.percentile">
<code class="sig-prename descclassname">Field.</code><code class="sig-name descname">percentile</code><span class="sig-paren">(</span><em class="sig-param">ranks</em>, <em class="sig-param">axes=None</em>, <em class="sig-param">interpolation='linear'</em>, <em class="sig-param">squeeze=False</em>, <em class="sig-param">mtol=1</em><span class="sig-paren">)</span><a class="reference external" href="https://github.com/NCAS-CMS/cf-python/blob/v3.7.0/cf/field.py#L17035-L17348"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cf.Field.percentile" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute percentiles of the data along the specified axes.</p>
<p>The default is to compute the percentiles along a flattened
version of the data.</p>
<p>If the input data are integers, or floats smaller than float64, or
the input data contains missing values, then output data type is
float64. Otherwise, the output data type is the same as that of
the input.</p>
<p>If multiple percentile ranks are given then a new, leading data
dimension is created so that percentiles can be stored for each
percentile rank.</p>
<p>The output field construct has a new dimension coordinate
construct that records the precentile ranks represented by its
data.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.0.4.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="cf.Field.bin.html#cf.Field.bin" title="cf.Field.bin"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bin</span></code></a>, <a class="reference internal" href="cf.Field.collapse.html#cf.Field.collapse" title="cf.Field.collapse"><code class="xref py py-obj docutils literal notranslate"><span class="pre">collapse</span></code></a>, <a class="reference internal" href="cf.Field.digitize.html#cf.Field.digitize" title="cf.Field.digitize"><code class="xref py py-obj docutils literal notranslate"><span class="pre">digitize</span></code></a>, <a class="reference internal" href="cf.Field.where.html#cf.Field.where" title="cf.Field.where"><code class="xref py py-obj docutils literal notranslate"><span class="pre">where</span></code></a></p>
</div>
<dl class="field-list">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl>
<dt>ranks: (sequence of) number</dt><dd><p>Percentile ranks, or sequence of percentile ranks, to
compute, which must be between 0 and 100 inclusive.</p>
</dd>
<dt>axes: (sequence of) <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a> or <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>, optional</dt><dd><p>Select the domain axes over which to calculate the
percentiles, defined by the domain axes that would be
selected by passing each given axis description to a call
of the field construct’s <a class="reference internal" href="cf.Field.domain_axis.html#cf.Field.domain_axis" title="cf.Field.domain_axis"><code class="xref py py-obj docutils literal notranslate"><span class="pre">domain_axis</span></code></a> method. For
example, for a value of <code class="docutils literal notranslate"><span class="pre">'X'</span></code>, the domain axis construct
returned by <code class="docutils literal notranslate"><span class="pre">f.domain_axis('X')</span></code> is selected.</p>
<p>By default, or if <em>axes</em> is <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a>, all axes are selected.</p>
</dd>
<dt>interpolation: <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code></a>, optional</dt><dd><p>Specify the interpolation method to use when the desired
percentile lies between two data values <code class="docutils literal notranslate"><span class="pre">i</span> <span class="pre">&lt;</span> <span class="pre">j</span></code>:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 27%" />
<col style="width: 73%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><em>interpolation</em></p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">'linear'</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">i+(j-i)*fraction</span></code>, where <code class="docutils literal notranslate"><span class="pre">fraction</span></code>
is the fractional part of the index
surrounded by <code class="docutils literal notranslate"><span class="pre">i</span></code> and <code class="docutils literal notranslate"><span class="pre">j</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">'lower'</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">i</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">'higher'</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">j</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">'nearest'</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">i</span></code> or <code class="docutils literal notranslate"><span class="pre">j</span></code>, whichever is nearest.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">'midpoint'</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">(i+j)/2</span></code></p></td>
</tr>
</tbody>
</table>
<p>By default <code class="docutils literal notranslate"><span class="pre">'linear'</span></code> interpolation is used.</p>
</dd>
<dt>squeeze: <a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bool</span></code></a>, optional</dt><dd><p>If True then all size 1 axes are removed from the returned
percentiles data. By default axes over which percentiles
have been calculated are left in the result as axes with
size 1, meaning that the result is guaranteed to broadcast
correctly against the original data.</p>
</dd>
<dt>mtol: number, optional</dt><dd><p>Set the fraction of input data elements which is allowed
to contain missing data when contributing to an individual
output data element. Where this fraction exceeds <em>mtol</em>,
missing data is returned. The default is 1, meaning that a
missing datum in the output array occurs when its
contributing input array elements are all missing data. A
value of 0 means that a missing datum in the output array
occurs whenever any of its contributing input array
elements are missing data. Any intermediate value is
permitted.</p>
<dl class="simple">
<dt><em>Parameter example:</em></dt><dd><p>To ensure that an output array element is a missing
datum if more than 25% of its input array elements are
missing data: <code class="docutils literal notranslate"><span class="pre">mtol=0.25</span></code>.</p>
</dd>
</dl>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt><a class="reference internal" href="../class/cf.Field.html#cf.Field" title="cf.Field"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Field</span></code></a></dt><dd><p>The percentiles of the original data.</p>
</dd>
</dl>
</dd>
</dl>
<p><strong>Examples:</strong></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">example_field</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="go">Field: specific_humidity</span>
<span class="go">------------------------</span>
<span class="go">Data            : specific_humidity(latitude(5), longitude(8)) 1</span>
<span class="go">Cell methods    : area: mean</span>
<span class="go">Dimension coords: time(1) = [2019-01-01 00:00:00]</span>
<span class="go">                : latitude(5) = [-75.0, ..., 75.0] degrees_north</span>
<span class="go">                : longitude(8) = [22.5, ..., 337.5] degrees_east</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[[0.007 0.034 0.003 0.014 0.018 0.037 0.024 0.029]</span>
<span class="go"> [0.023 0.036 0.045 0.062 0.046 0.073 0.006 0.066]</span>
<span class="go"> [0.11  0.131 0.124 0.146 0.087 0.103 0.057 0.011]</span>
<span class="go"> [0.029 0.059 0.039 0.07  0.058 0.072 0.009 0.017]</span>
<span class="go"> [0.006 0.036 0.019 0.035 0.018 0.037 0.034 0.013]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">percentile</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">80</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="go">Field: specific_humidity</span>
<span class="go">------------------------</span>
<span class="go">Data            : specific_humidity(long_name=Percentile ranks for latitude, longitude dimensions(5), latitude(1), longitude(1)) 1</span>
<span class="go">Dimension coords: time(1) = [2019-01-01 00:00:00]</span>
<span class="go">                : latitude(1) = [0.0] degrees_north</span>
<span class="go">                : longitude(1) = [180.0] degrees_east</span>
<span class="go">                : long_name=Percentile ranks for latitude, longitude dimensions(5) = [20, ..., 80]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[[[0.0164]]</span>
<span class="go"> [[0.032 ]]</span>
<span class="go"> [[0.036 ]]</span>
<span class="go"> [[0.0414]]</span>
<span class="go"> [[0.0704]]]</span>
</pre></div>
</div>
<p>Find the standard deviation of the values above the 80th percentile:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p80</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="mi">80</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">p80</span><span class="p">)</span>
<span class="go">Field: specific_humidity</span>
<span class="go">------------------------</span>
<span class="go">Data            : specific_humidity(latitude(1), longitude(1)) 1</span>
<span class="go">Dimension coords: time(1) = [2019-01-01 00:00:00]</span>
<span class="go">                : latitude(1) = [0.0] degrees_north</span>
<span class="go">                : longitude(1) = [180.0] degrees_east</span>
<span class="go">                : long_name=Percentile ranks for latitude, longitude dimensions(1) = [80]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">f</span><span class="o">&lt;=</span><span class="n">p80</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">masked</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[[  --    --    --    --    --    -- -- --]</span>
<span class="go"> [  --    --    --    --    -- 0.073 -- --]</span>
<span class="go"> [0.11 0.131 0.124 0.146 0.087 0.103 -- --]</span>
<span class="go"> [  --    --    --    --    -- 0.072 -- --]</span>
<span class="go"> [  --    --    --    --    --    -- -- --]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;standard_deviation&#39;</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
<span class="go">&lt;CF Data(1, 1): [[0.024609938742357642]] 1&gt;</span>
</pre></div>
</div>
<p>Find the mean of the values above the 45th percentile along the
X axis:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p45</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">p45</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[[0.0189 ]</span>
<span class="go"> [0.04515]</span>
<span class="go"> [0.10405]</span>
<span class="go"> [0.04185]</span>
<span class="go"> [0.02125]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">f</span><span class="o">&lt;=</span><span class="n">p45</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">masked</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[[  -- 0.034    --    --    -- 0.037 0.024 0.029]</span>
<span class="go"> [  --    --    -- 0.062 0.046 0.073    -- 0.066]</span>
<span class="go"> [0.11 0.131 0.124 0.146    --    --    --    --]</span>
<span class="go"> [  -- 0.059    -- 0.07  0.058 0.072    --    --]</span>
<span class="go"> [  -- 0.036    -- 0.035   --  0.037 0.034    --]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;X: mean&#39;</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[[0.031  ]</span>
<span class="go"> [0.06175]</span>
<span class="go"> [0.12775]</span>
<span class="go"> [0.06475]</span>
<span class="go"> [0.0355 ]]</span>
</pre></div>
</div>
<p>Find the histogram bin boundaries associated with given
percentiles, and digitize the data based on these bins:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bins</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">percentile</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">bins</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[0.003  0.0088 0.036  0.1037 0.146 ]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">i</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">closed_ends</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">[[0 1 0 1 1 2 1 1]</span>
<span class="go"> [1 2 2 2 2 2 0 2]</span>
<span class="go"> [3 3 3 3 2 2 2 1]</span>
<span class="go"> [1 2 2 2 2 2 1 1]</span>
<span class="go"> [0 2 1 1 1 2 1 1]]</span>
</pre></div>
</div>
</dd></dl>

</div>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2020, NCAS | Page built on 2020-10-15.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>